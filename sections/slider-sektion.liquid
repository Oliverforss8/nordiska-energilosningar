{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = 'section-slider-sektion'
%}

<section
  id="{{ section_id }}"
  class="{{ section_class }} layout py-[60px] md:py-[85px]"
>
  <div class="flex flex-col gap-[40px] md:gap-[50px]">
    {% if section.settings.title != blank %}
      <h2 class="headline1 text-[#171717]">{{ section.settings.title }}</h2>
    {% endif %}

    <div class="relative">
      <!-- Slider Container -->
      <div
        class="product-slider overflow-hidden"
        data-slider
      >
        <div
          class="flex gap-[20px] transition-transform duration-500 ease-in-out md:gap-[30px]"
          data-slider-track
        >
          {% for block in section.blocks %}
            {% if block.settings.product != blank %}
              {% liquid
                assign product = block.settings.product
                assign card_title = product.title
                assign card_description = block.settings.description

                if card_description == blank
                  assign card_description = product.description | strip_html | truncatewords: 10
                endif
              %}
              <div
                class="slider-item w-[calc(100%/1.5-20px*0.5)] min-w-[calc(100%/1.5-20px*0.5)] max-w-[calc(100%/1.5-20px*0.5)] shrink-0 md:min-w-[calc(50%-15px)] md:max-w-[calc(50%-15px)] xl:min-w-[calc(25%-22.5px)] xl:max-w-[calc(25%-22.5px)]"
                {{ block.shopify_attributes }}
              >
                <div class="flex h-full flex-col overflow-hidden rounded-[15px] border border-[#171717]/10 bg-[#f5f5f5]">
                  <!-- Product Image -->
                  {% if product.featured_image %}
                    <a href="{{ product.url }}" class="block">
                      <img
                        src="{{ product.featured_image | image_url: width: 400 }}"
                        alt="{{ product.featured_image.alt | default: product.title }}"
                        class="h-[280px] w-full object-contain"
                        width="400"
                        height="280"
                        loading="lazy"
                      >
                    </a>
                  {% else %}
                    <div class="flex h-[280px] w-full items-center justify-center bg-gray-200 text-gray-500">
                      {{ 'products.product.media.load_image' | t }}
                    </div>
                  {% endif %}

                  <!-- Product Info -->
                  <div class="flex flex-1 flex-col gap-[20px] p-[20px] md:p-[25px]">
                    <div class="flex flex-1 flex-col">
                      <h3 class="headline1 pt-[10px] !text-[26px] text-[#171717]">
                        {{ card_title }}
                      </h3>

                      {% if block.settings.show_price %}
                        <div class="body1 pt-[10px] !text-[14px] font-[400] text-[#171717]/80">
                          {{ product.price | money }}
                        </div>
                      {% endif %}

                      {% if card_description != blank %}
                        <p class="text py-[20px] !text-[16px] text-[#171717]/75">
                          {{ card_description }}
                        </p>
                      {% endif %}
                    </div>

                    <!-- Button -->
                    <button class=" flex bg-transparent">
                      <a
                        href="{{ product.url }}"
                        class="knappetikett flex flex-row items-center justify-center gap-[15px] rounded-full px-[20px] py-[15px] text-[#171717] transition-colors"
                        style="background: linear-gradient(135deg, #FFA94D 0%, #FF4E33 100%);"
                      >
                        Köp nu
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="14"
                          viewBox="0 0 22 18"
                          fill="none"
                          class="shrink-0"
                        >
                          <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </a>
                    </button>
                  </div>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Progress Indicator Line (Mobile & Tablet) -->
      <div class="mt-[25px] lg:hidden">
        <div class="relative h-[2px] w-full overflow-hidden rounded-full bg-[#171717]/10">
          <div
            data-slider-progress
            class="absolute left-0 top-0 h-full bg-[#171717] transition-all duration-500 ease-in-out"
            style="width: 0%; transform: translateX(0)"
          ></div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      {% if section.blocks.size > 1 %}
        <div class="mt-[30px] flex items-center justify-center gap-[15px] lg:absolute lg:right-0 lg:top-[-80px] lg:mt-0 lg:gap-[10px]">
          <button
            data-slider-prev
            class="flex h-[45px] w-[45px] items-center justify-center rounded-full border border-[#171717]/20 bg-white transition-all duration-300 hover:border-transparent disabled:cursor-not-allowed disabled:opacity-50"
            style="background: white;"
            onmouseover="this.style.background='linear-gradient(135deg, #FFA94D 0%, #FF4E33 100%)'; this.style.borderColor='transparent';"
            onmouseout="this.style.background='white'; this.style.borderColor='rgba(23, 23, 23, 0.2)';"
            aria-label="Föregående"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="16"
              viewBox="0 0 22 18"
              fill="none"
              class="rotate-180"
            >
              <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button
            data-slider-next
            class="flex h-[45px] w-[45px] items-center justify-center rounded-full border border-[#171717]/20 bg-white transition-all duration-300 hover:border-transparent disabled:cursor-not-allowed disabled:opacity-50"
            style="background: white;"
            onmouseover="this.style.background='linear-gradient(135deg, #FFA94D 0%, #FF4E33 100%)'; this.style.borderColor='transparent';"
            onmouseout="this.style.background='white'; this.style.borderColor='rgba(23, 23, 23, 0.2)';"
            aria-label="Nästa"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="16"
              viewBox="0 0 22 18"
              fill="none"
            >
              <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<script src="{{ 'product-slider.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Produktslider",
  "tag": "section",
  "class": "section-slider-sektion",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Titel",
      "default": "Våra produkter"
    },
    {
      "type": "text",
      "id": "custom_id",
      "label": "Anpassat ID",
      "info": "Lämna tomt för att använda standard ID"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Produkt",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Välj produkt",
          "info": "Produktens titel och beskrivning hämtas automatiskt"
        },
        {
          "type": "checkbox",
          "id": "show_price",
          "label": "Visa pris",
          "default": true
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Beskrivning (valfritt)",
          "info": "Lämna tom för att automatiskt använda produktens beskrivning (första 10 orden). Fyll i för att åsidosätta med egen text."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Produktslider",
      "blocks": [
        {
          "type": "product"
        },
        {
          "type": "product"
        },
        {
          "type": "product"
        },
        {
          "type": "product"
        }
      ]
    }
  ]
}
{% endschema %}
