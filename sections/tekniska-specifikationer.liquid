{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = "section-tekniska-specifikationer"
%}

<section
  id='{{ section_id }}'
  class='{{ section_class }} layout py-[62px] md:py-[87px]'
>
  {% if section.settings.title != blank %}
    <h2 class='headline1 text-[#171717] text-center pb-[40px] md:pb-[50px]'>
      {{ section.settings.title }}
    </h2>
  {% endif %}

  <div class='flex flex-col lg:flex-row gap-[40px] md:gap-[50px]'>
    <!-- Bildkarusell -->
    <div class='flex-1'>
      {% if section.settings.image_1 != blank
        or section.settings.image_2 != blank
        or section.settings.image_3 != blank
      %}
        <div class='relative'>
          <div class='image-carousel overflow-hidden rounded-[15px] h-[400px] md:h-[500px]'>
            {% if section.settings.image_1 != blank %}
              <img
                src='{{ section.settings.image_1 | image_url: width: 800 }}'
                alt='{{ section.settings.image_1.alt | default: section.settings.product_name }}'
                class='carousel-image w-full h-full object-contain transition-opacity duration-500'
                data-image-index='0'
                width='800'
                height='500'
                loading='lazy'
              >
            {% endif %}
            {% if section.settings.image_2 != blank %}
              <img
                src='{{ section.settings.image_2 | image_url: width: 800 }}'
                alt='{{ section.settings.image_2.alt | default: section.settings.product_name }}'
                class='carousel-image w-full h-full object-cover transition-opacity duration-500 opacity-0 absolute inset-0'
                data-image-index='1'
                width='800'
                height='500'
                loading='lazy'
              >
            {% endif %}
            {% if section.settings.image_3 != blank %}
              <img
                src='{{ section.settings.image_3 | image_url: width: 800 }}'
                alt='{{ section.settings.image_3.alt | default: section.settings.product_name }}'
                class='carousel-image w-full h-full object-cover transition-opacity duration-500 opacity-0 absolute inset-0'
                data-image-index='2'
                width='800'
                height='500'
                loading='lazy'
              >
            {% endif %}
          </div>

          <!-- Karusellpunkter -->
          <div class='flex justify-center gap-[10px] pt-[20px]'>
            {% if section.settings.image_1 != blank %}
              <button
                class='carousel-dot w-[12px] h-[12px] rounded-full bg-[#171717] opacity-100 transition-opacity duration-300'
                data-dot-index='0'
              ></button>
            {% endif %}
            {% if section.settings.image_2 != blank %}
              <button
                class='carousel-dot w-[12px] h-[12px] rounded-full bg-[#171717] opacity-30 transition-opacity duration-300'
                data-dot-index='1'
              ></button>
            {% endif %}
            {% if section.settings.image_3 != blank %}
              <button
                class='carousel-dot w-[12px] h-[12px] rounded-full bg-[#171717] opacity-30 transition-opacity duration-300'
                data-dot-index='2'
              ></button>
            {% endif %}
          </div>
        </div>
      {% else %}
        <div class='w-full h-[400px] md:h-[500px] bg-gray-200 rounded-[15px] flex items-center justify-center text-gray-500'>
          Välj produktbilder
        </div>
      {% endif %}
    </div>

    <!-- Produktdetaljer -->
    <div class='flex-1 flex flex-col'>
      <!-- Specifikationer -->
      {% if section.blocks.size > 0 %}
        <div class='specifications relative flex flex-col gap-[20px]'>
          <!-- Kontinuerlig vertikal linje -->
          <div
            class='absolute left-1/2 top-0 bottom-0 w-[1px] bg-[#E5E5E5] transform -translate-x-1/2'
          ></div>

          {% for block in section.blocks %}
            {% if block.type == "specification" %}
              <div
                class='spec-item flex flex-row items-center border-b border-[#E5E5E5] pb-[15px] relative'
                {{ block.shopify_attributes }}
              >
                <span class='text text-[#171717] font-[500] flex-1 pr-[20px]'>
                  {{ block.settings.label }}
                </span>
                <span class='text text-[#171717] flex-1 pl-[20px] text-right'>
                  {{ block.settings.value }}
                </span>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      {% if section.settings.button_text != blank
        and section.settings.button_link != blank
      %}
        <div class='pt-[40px]'>
          <a
            href='{{ section.settings.button_link }}'
            class='px-[20px] py-[17px] rounded-[10px] knappetikett text-[#171717] bg-[#EBCF2F] hover:bg-[#D4B82A] transition-colors inline-flex items-center gap-[20px]'
          >
            {{ section.settings.button_text }}
            <svg
              xmlns='http://www.w3.org/2000/svg'
              width='22'
              height='18'
              viewBox='0 0 22 18'
              fill='none'
            >
              <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const carousel = document.querySelector('.image-carousel');
    if (!carousel) return;

    const images = carousel.querySelectorAll('.carousel-image');
    const dots = document.querySelectorAll('.carousel-dot');
    let currentIndex = 0;

    function showImage(index) {
      images.forEach((img, i) => {
        img.style.opacity = i === index ? '1' : '0';
      });

      dots.forEach((dot, i) => {
        dot.style.opacity = i === index ? '1' : '0.3';
      });
    }

    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentIndex = index;
        showImage(currentIndex);
      });
    });

    // Auto-rotera var 5:e sekund
    if (images.length > 1) {
      setInterval(() => {
        currentIndex = (currentIndex + 1) % images.length;
        showImage(currentIndex);
      }, 5000);
    }
  });
</script>

{% schema %}
{
  "name": "Tekniska specifikationer",
  "tag": "section",
  "class": "section-tekniska-specifikationer",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Rubrik",
      "default": "Tekniska specifikationer"
    },
    {
      "type": "header",
      "content": "Produktbilder"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Första bilden"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Andra bilden"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Tredje bilden"
    },
    {
      "type": "header",
      "content": "Produktinformation"
    },
    {
      "type": "text",
      "id": "product_name",
      "label": "Produktnamn",
      "default": "Produktnamn"
    },
    {
      "type": "text",
      "id": "stack_info",
      "label": "Stack information",
      "default": "Stack"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Beskrivning",
      "default": "Produktbeskrivning här..."
    },
    {
      "type": "header",
      "content": "Knapp"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Knapptext"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Knapplänk"
    },
    {
      "type": "text",
      "id": "custom_id",
      "label": "Anpassat ID",
      "info": "Lämna tomt för att använda standard ID"
    }
  ],
  "blocks": [
    {
      "type": "specification",
      "name": "Specifikation",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Etikett",
          "default": "Specifikation"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Värde",
          "default": "Värde"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tekniska specifikationer"
    }
  ]
}
{% endschema %}
