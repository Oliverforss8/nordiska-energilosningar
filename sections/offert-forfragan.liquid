<section class='layout pt-[150px]'>
  <div class='flex flex-col lg:flex-row  xl:grid xl:grid-cols-2 gap-[20px]'>
    <!-- Form Section -->
    <div class='quote-form-section p-[20px] md:p-[50px] bg-[#F3F1E8] rounded-[15px] lg:w-[64%] xl:w-full xl:flex-shrink-0'>
      <div class='flex flex-col'>
        <div class='headline1 text-[40px]'>Offert förfrågan</div>
        <div class=' body1 text-[20px] py-[30px] opacity-80'>
          Ett solcellssystem med batteri och AI-styrning gör att du inte bara
          producerar egen el!
        </div>
        <form
          class='flex flex-col gap-[15px] md:gap-[20px]'
          id='quote-form'
          action='https://formspree.io/f/mdkllzwo'
          method='POST'
        >
          <input
            class='body1 pl-[15px] text-[16px] md:text-[18px] text-[#171717]/85 bg-white rounded-[10px] h-[45px]'
            placeholder='För- & efternamn'
            type='text'
            name='name'
            required
          >
          <input
            class='body1 pl-[15px] text-[16px] md:text-[18px] text-[#171717]/85 bg-white rounded-[10px] h-[45px]'
            placeholder='E-postadress'
            type='email'
            name='email'
            required
          >
          <input
            class='body1 pl-[15px] text-[16px] md:text-[18px] text-[#171717]/85 bg-white rounded-[10px] h-[45px]'
            placeholder='Telefonnummer'
            type='tel'
            name='phone'
          >
          <input
            class='body1 pl-[15px] text-[16px] md:text-[18px] text-[#171717]/85 bg-white rounded-[10px] h-[45px]'
            placeholder='Adress'
            type='text'
            name='address'
          >
          <div class='body1 text-[20px] md:text-[25px] flex gap-[5px] flex-col md:flex-row'>
            Hur kan vi hjälpa dig?
            <span class='text-[13px] md:text-[15px] opacity-70'>
              Klicka för att välja (flera val möjligt)*
            </span>
          </div>
          <div class='flex flex-row flex-wrap gap-[10px]'>
            <button
              type='button'
              class='bg-white headline1 text-[18px] md:text-[20px] px-[15px] py-[10px] rounded-[10px] flex flex-row gap-[10px] items-center justify-center service-option'
              data-service='solceller'
            >
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='29'
                height='18'
                viewBox='0 0 29 18'
                fill='none'
              >
                <path d="M28.158 10.9256H12.7738L6.98633 1H22.3705L28.158 10.9256Z" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M24.0185 8.69895L20.5454 2.77808H11.0137L14.4867 8.69895H24.0185Z" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M22.1621 5.73865H12.8701" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.8389 2.83813L19.192 8.63916" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.95442 1L1.16699 10.9256H3.20773L5.28695 7.48052" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3.20801 10.9255V16.9999H14.0598V10.9255" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14.0596 17.0001H26.2569V10.9856" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.86596 16.9999V12.9615H6.68652V16.9999" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Solceller
            </button>
            <button
              type='button'
              class='bg-white headline1 text-[18px] md:text-[20px] px-[15px] py-[10px] rounded-[10px] flex flex-row gap-[10px] items-center justify-center service-option'
              data-service='laddbox'
            >
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='25'
                height='18'
                viewBox='0 0 25 18'
                fill='none'
              >
                <path d="M7.65948 11.3927C6.14107 11.3927 4.91016 12.6236 4.91016 14.142C4.91016 15.6604 6.14107 16.8914 7.65948 16.8914C9.17789 16.8914 10.4088 15.6604 10.4088 14.142C10.4088 12.6236 9.17785 11.3927 7.65948 11.3927Z" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4.42336 3.96602L4.2199 6.05353L1.25195 6.35472M1.25195 2.78259C4.65122 2.78259 8.80464 3.18546 8.80464 3.18546L6.82778 5.86428L4.2199 6.05358" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14.2494 7.16021C13.5714 6.04852 12.3365 4.2139 11.8366 3.67599C11.3155 3.11518 13.8323 2.53408 12.728 2.23456C10.527 1.63753 4.65011 1.41443 1.25165 1.41443C0.939933 1.41443 1.53172 1.41595 1.25165 1.41924" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.20996 10.3246C10.1831 10.6664 10.9727 11.3936 11.3933 12.3353L11.9 13.4698L13.8561 13.2624" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1.25195 14.6555H3.38022L3.58082 13.2163C3.73513 12.1091 4.52556 11.1283 5.47664 10.5409" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12.1346 6.92986L11.1736 6.43132C10.9144 6.27267 10.812 5.92281 10.9394 5.63031L12.0741 4.0697" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1.18457 17.0001H23.7905" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M19.625 16.8913V12.5834" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21.8779 12.5834V16.8913" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M24.0129 11.954L21.9771 12.4686C21.1831 12.6692 20.3201 12.6692 19.5261 12.4686L17.4902 11.954V1.66503L19.5261 1.15052C20.3201 0.949826 21.1831 0.949826 21.9771 1.15052L24.0129 1.66503V11.954Z" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21.1041 5.34875L20.1318 6.8001H21.3709L20.6104 8.27022" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.9209 8.46094H13.3772C14.1556 8.46094 14.8108 9.04324 14.9023 9.81622L15.3872 13.7243C15.4307 14.0922 15.7426 14.3693 16.1131 14.3693H17.4837C17.8873 14.3693 18.2146 14.0421 18.2146 13.6384V12.2126" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.921 9.14697H8.81256C8.43067 9.14697 8.12109 8.8374 8.12109 8.45551C8.12109 8.07361 8.43067 7.76404 8.81256 7.76404H9.921V9.14697Z" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Laddbox
            </button>
            <button
              type='button'
              class='bg-white headline1 text-[18px] md:text-[20px] px-[15px] py-[10px] rounded-[10px] flex flex-row gap-[10px] items-center justify-center service-option'
              data-service='batteri'
            >
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='11'
                height='18'
                viewBox='0 0 11 18'
                fill='none'
              >
                <path d="M8.14291 11.8178V1.48787L5.689 1.0896C4.95299 0.970133 4.20256 0.970133 3.46661 1.0896L1.0127 1.48787V11.8178L3.46661 12.2161C4.20261 12.3355 4.95305 12.3355 5.689 12.2161L8.14291 11.8178Z" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5.5791 12.448V16.9435" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3.57617 16.9435V12.448" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5.05313 4.68481L3.74316 6.64017H5.41254L4.38795 8.62074" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8.14258 4.68481L9.52867 5.3987V8.24138H8.14258" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.52937 8.24146V13.0073C9.52937 13.6173 9.03485 14.1118 8.42484 14.1118C7.81483 14.1118 7.32031 13.6173 7.32031 13.0073V12.0734" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2.1748 17H7.01923" stroke="#171717" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Batteri
            </button>
          </div>

          <!-- Hidden fields with product information -->
          <input
            type='hidden'
            name='selected_service'
            id='selected_service'
          >
          <input
            type='hidden'
            name='product_title'
            value='{{ product.title }}'
          >
          <input
            type='hidden'
            name='product_handle'
            value='{{ product.handle }}'
          >
          <input
            type='hidden'
            name='product_id'
            value='{{ product.id }}'
          >
          <input
            type='hidden'
            name='product_url'
            value='{{ shop.secure_url }}{{ product.url }}'
          >
          <input
            type='hidden'
            name='_subject'
            value='Offert förfrågan för {{ product.title }}'
          >
          <button
            type='submit'
            class='w-full headline1 text-[18px] md:text-[20px] bg-[#EFD959] rounded-[10px] py-[14px] flex flex-row gap-[15px] md:gap-[20px] items-center justify-center quote-submit-btn'
          >
            Få ditt förslag
            <svg
              xmlns='http://www.w3.org/2000/svg'
              width='18'
              height='14'
              viewBox='0 0 18 14'
              fill='none'
            >
              <path d="M1.66699 7.00009H16.667L10.7974 1.13049" stroke="#171717" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1.66699 7.00004H16.667L10.7974 12.8696" stroke="#171717" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </form>
      </div>
    </div>

    <!-- Success Section (hidden initially) -->
    <div
      class='quote-success-section p-[20px] md:p-[50px] rounded-[15px] lg:w-[64%] xl:w-full xl:flex-shrink-0 h-full flex flex-col relative hidden'
      style='background: #EFD959;'
    >
      <div
        class='absolute inset-0 rounded-[15px]'
        style='background: url({{ "Gradient.png" | asset_url }}) center/cover no-repeat; opacity: 0.5;'
      ></div>
      <div class='relative z-10 flex flex-col h-full'>
        <div class='flex flex-col h-full'>
          <div class='headline1 text-[40px]'>Tack för din förfrågan!</div>
          <div class='body1 text-[20px] pt-[30px] opacity-80'>
            Vi har mottagit din offertförfrågan och återkommer inom kort med ett
            skräddarsytt förslag.
          </div>
        </div>
        <div class='flex flex-col h-full'>
          <div class='headline1 text-[40px] pb-[30px]'>Vad händer nu?</div>
          <div class='flex flex-wrap gap-[20px]'>
            <button class='bg-white items-center gap-[30px] flex flex-row headline1 text-[24px] px-[30px] rounded-[15px] py-[15px]'>
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='39'
                height='36'
                viewBox='0 0 39 36'
                fill='none'
              >
                <path opacity="0.8" d="M4.562 26.5831C2 24.5013 2 22.9262 2 16.2222C2 9.51822 2 6.16533 4.562 4.08356C7.1275 2 11.2505 2 19.5 2C27.7495 2 31.8742 2 34.4362 4.08356C36.9982 6.16711 37 9.51822 37 16.2222C37 22.9262 37 24.5013 34.4362 26.5831C31.876 28.6667 27.7495 28.6667 19.5 28.6667C15.1075 28.6667 12.85 31.7564 9 34V28.2898C7.0855 28 5.67675 27.4898 4.562 26.5831Z" stroke="#171717" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Vi kontaktar dig
            </button>
            <button class='bg-white items-center gap-[30px] flex flex-row headline1 text-[24px] px-[30px] rounded-[15px] py-[15px]'>
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='36'
                height='44'
                viewBox='0 0 36 44'
                fill='none'
              >
                <g opacity="0.8">
                  <path d="M27.05 5H32C32.5304 5 33.0391 5.21071 33.4142 5.58579C33.7893 5.96086 34 6.46957 34 7V40C34 40.5304 33.7893 41.0391 33.4142 41.4142C33.0391 41.7893 32.5304 42 32 42H4C3.46957 42 2.96086 41.7893 2.58579 41.4142C2.21071 41.0391 2 40.5304 2 40V7C2 6.46957 2.21071 5.96086 2.58579 5.58579C2.96086 5.21071 3.46957 5 4 5H11V8H25V5H27.05Z" stroke="#171717" stroke-width="3" stroke-linejoin="round"/>
                  <path d="M21 17L13 25.001H23.004L15 33.001M11 2H25V8H11V2Z" stroke="#171717" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </g>
              </svg>
              Du får ett anpassat förslag
            </button>
            <button class='bg-white items-center gap-[30px] flex flex-row headline1 text-[24px] px-[30px] rounded-[15px] py-[15px]'>
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='33'
                height='40'
                viewBox='0 0 33 40'
                fill='none'
              >
                <path opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M16.5 9.74998e-06C13.8653 -0.00351821 11.3181 0.950489 9.32765 2.68626C7.33723 4.42203 6.03772 6.82261 5.66856 9.44571C5.2994 12.0688 5.88545 14.7377 7.31874 16.9606C8.75203 19.1835 10.936 20.8108 13.4682 21.5424C9.86986 21.9818 6.78383 23.2606 4.45726 25.5667C1.49781 28.497 0 32.8636 0 38.5606C0 38.9424 0.150819 39.3085 0.419278 39.5784C0.687738 39.8484 1.05185 40 1.43151 40C1.81117 40 2.17528 39.8484 2.44373 39.5784C2.71219 39.3085 2.86301 38.9424 2.86301 38.5606C2.86301 33.3485 4.22822 29.8333 6.4674 27.6152C8.70959 25.3939 12.0608 24.2424 16.5 24.2424C20.9392 24.2424 24.2904 25.3939 26.5356 27.6152C28.7718 29.8364 30.137 33.3485 30.137 38.5606C30.137 38.9424 30.2878 39.3085 30.5563 39.5784C30.8247 39.8484 31.1888 40 31.5685 40C31.9482 40 32.3123 39.8484 32.5807 39.5784C32.8492 39.3085 33 38.9424 33 38.5606C33 32.8636 31.5022 28.5 28.5397 25.5667C26.2192 23.2636 23.1301 21.9818 19.5318 21.5424C22.0556 20.8025 24.2296 19.1728 25.6554 16.952C27.0812 14.7313 27.6633 12.0682 27.295 9.45089C26.9266 6.83362 25.6326 4.43749 23.6499 2.7017C21.6672 0.965914 19.1289 0.00674768 16.5 9.74998e-06ZM8.43835 10.9849C8.43835 8.835 9.2877 6.77319 10.7996 5.25301C12.3114 3.73283 14.3619 2.8788 16.5 2.8788C18.6381 2.8788 20.6886 3.73283 22.2004 5.25301C23.7123 6.77319 24.5616 8.835 24.5616 10.9849C24.5616 13.1347 23.7123 15.1965 22.2004 16.7167C20.6886 18.2369 18.6381 19.0909 16.5 19.0909C14.3619 19.0909 12.3114 18.2369 10.7996 16.7167C9.2877 15.1965 8.43835 13.1347 8.43835 10.9849Z" fill="#171717"/>
              </svg>
              Sen är beslutet ditt!
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class='flex flex-col gap-[10px] flex-1'>
      <div class='relative h-[200px] lg:h-full overflow-hidden rounded-[15px]'>
        <img
          src='{{ section.settings.card_1_image | image_url: width: 600 }}'
          alt='{{ section.settings.card_1_image.alt | escape }}'
          width='600'
          height='300'
          class='w-full h-full object-cover absolute inset-0'
        >
        {% if section.settings.card_1_overlay_opacity > 0 %}
          <div
            class='absolute inset-0 rounded-[15px]'
            style='background-color: rgba(0, 0, 0, {{ section.settings.card_1_overlay_opacity | divided_by: 100.0 }});'
          ></div>
        {% endif %}
        {% if section.settings.card_1_button_text != blank
          and section.settings.card_1_button_link != blank
        %}
          <a
            href='{{ section.settings.card_1_button_link }}'
            class='absolute p-[20px]  inset-0 flex items-end justify-start no-underline z-10'
          >
            <button class='bg-[#FFF] text-[15px] md:text-[20px] py-[15px] md:py-[18px] px-[20px] md:px-[30px] rounded-[10px] knappetikett text-[#171717] no-underline'>
              {{ section.settings.card_1_button_text | escape }}
            </button>
          </a>
        {% endif %}
      </div>

      <div class='relative h-[200px] lg:h-full overflow-hidden rounded-[15px]'>
        <img
          src='{{ section.settings.card_2_image | image_url: width: 600 }}'
          alt='{{ section.settings.card_2_image.alt | escape }}'
          width='600'
          height='300'
          class='w-full h-full object-cover absolute inset-0'
        >
        {% if section.settings.card_2_overlay_opacity > 0 %}
          <div
            class='absolute inset-0 rounded-[15px]'
            style='background-color: rgba(0, 0, 0, {{ section.settings.card_2_overlay_opacity | divided_by: 100.0 }});'
          ></div>
        {% endif %}
        {% if section.settings.card_2_button_text != blank
          and section.settings.card_2_button_link != blank
        %}
          <a
            href='{{ section.settings.card_2_button_link }}'
            class='absolute p-[20px]  inset-0 flex items-end justify-start no-underline z-10'
          >
            <button class='bg-[#FFF] text-[15px] md:text-[20px] py-[15px] md:py-[18px] px-[20px] md:px-[30px] rounded-[10px] knappetikett text-[#171717] no-underline'>
              {{ section.settings.card_2_button_text | escape }}
            </button>
          </a>
        {% endif %}
      </div>

      <div class='relative h-[200px] lg:h-full overflow-hidden rounded-[15px]'>
        <img
          src='{{ section.settings.card_3_image | image_url: width: 600 }}'
          alt='{{ section.settings.card_3_image.alt | escape }}'
          width='600'
          height='300'
          class='w-full h-full object-cover absolute inset-0'
        >
        {% if section.settings.card_3_overlay_opacity > 0 %}
          <div
            class='absolute inset-0 rounded-[15px]'
            style='background-color: rgba(0, 0, 0, {{ section.settings.card_3_overlay_opacity | divided_by: 100.0 }});'
          ></div>
        {% endif %}
        {% if section.settings.card_3_button_text != blank
          and section.settings.card_3_button_link != blank
        %}
          <a
            href='{{ section.settings.card_3_button_link }}'
            class='absolute p-[20px]  inset-0 flex items-end justify-start no-underline z-10'
          >
            <button class='bg-[#FFF] text-[15px] md:text-[20px] py-[15px] md:py-[18px] px-[20px] md:px-[30px] rounded-[10px] knappetikett text-[#171717] no-underline'>
              {{ section.settings.card_3_button_text | escape }}
            </button>
          </a>
        {% endif %}
      </div>

      <div class='relative h-[200px] lg:h-full overflow-hidden rounded-[15px]'>
        <img
          src='{{ section.settings.card_4_image | image_url: width: 600 }}'
          alt='{{ section.settings.card_4_image.alt | escape }}'
          width='600'
          height='300'
          class='w-full h-full object-cover absolute inset-0'
        >
        {% if section.settings.card_4_overlay_opacity > 0 %}
          <div
            class='absolute inset-0 rounded-[15px]'
            style='background-color: rgba(0, 0, 0, {{ section.settings.card_4_overlay_opacity | divided_by: 100.0 }});'
          ></div>
        {% endif %}
        {% if section.settings.card_4_button_text != blank
          and section.settings.card_4_button_link != blank
        %}
          <a
            href='{{ section.settings.card_4_button_link }}'
            class='absolute p-[20px]  inset-0 flex items-end justify-start no-underline z-10'
          >
            <button class='bg-[#FFF] text-[15px] md:text-[20px] py-[15px] md:py-[18px] px-[20px] md:px-[30px] rounded-[10px] knappetikett text-[#171717] no-underline'>
              {{ section.settings.card_4_button_text | escape }}
            </button>
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% javascript %}
  // Quote form functionality
  document.addEventListener('DOMContentLoaded', function () {
    console.log('Quote form script loaded in section!');

    const serviceOptions = document.querySelectorAll('.service-option');
    const selectedServiceInput = document.getElementById('selected_service');
    const quoteSubmitBtn = document.querySelector('.quote-submit-btn');

    console.log('Found service options:', serviceOptions.length);

    // Handle service option selection (multiple selection)
    serviceOptions.forEach((option, index) => {
      console.log('Setting up listener for option', index);

      option.addEventListener('click', function (e) {
        e.preventDefault();
        console.log('Button clicked!', this);

        const service = this.getAttribute('data-service');
        const isSelected = this.getAttribute('data-selected') === 'true';

        console.log('Service:', service, 'Is selected:', isSelected);

        if (isSelected) {
          // Deselect this option
          this.style.backgroundColor = 'white';
          this.setAttribute('data-selected', 'false');
          console.log('Deselected:', service);
        } else {
          // Select this option
          this.style.backgroundColor = '#EFD959';
          this.setAttribute('data-selected', 'true');
          console.log('Selected:', service);
        }

        // Update hidden input with all selected services
        const selectedServices = [];
        serviceOptions.forEach((opt) => {
          if (opt.getAttribute('data-selected') === 'true') {
            selectedServices.push(opt.getAttribute('data-service'));
          }
        });

        if (selectedServiceInput) {
          selectedServiceInput.value = selectedServices.join(', ');
        }

        console.log('All selected services:', selectedServices);
      });
    });

    // Handle form submission
    const quoteForm = document.getElementById('quote-form');
    if (quoteForm) {
      quoteForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        // Basic validation
        const name = this.querySelector('input[name="name"]');
        const email = this.querySelector('input[name="email"]');
        const selectedService = selectedServiceInput
          ? selectedServiceInput.value
          : '';

        if (!name || !name.value.trim()) {
          alert('Vänligen fyll i ditt namn');
          if (name) name.focus();
          return;
        }

        if (!email || !email.value.trim()) {
          alert('Vänligen fyll i din e-postadress');
          if (email) email.focus();
          return;
        }

        if (!selectedService || selectedService.trim() === '') {
          alert('Vänligen välj minst en tjänst');
          return;
        }

        const submitBtn = this.querySelector('.quote-submit-btn');

        // Show loading state
        if (submitBtn) {
          const originalText = submitBtn.innerHTML;
          submitBtn.innerHTML = 'Skickar...';
          submitBtn.disabled = true;

          try {
            // Submit to Formspree
            const formData = new FormData(this);

            const response = await fetch('https://formspree.io/f/mdkllzwo', {
              method: 'POST',
              body: formData,
              headers: {
                Accept: 'application/json',
              },
            });

            if (response.ok) {
              // Hide the form section and show the success section
              const formSection = document.querySelector('.quote-form-section');
              const successSection = document.querySelector(
                '.quote-success-section',
              );

              if (formSection && successSection) {
                formSection.style.display = 'none';
                successSection.style.display = 'block';
              } else {
                // Fallback to alert if sections not found
                alert('Tack för din förfrågan! Vi återkommer inom kort.');
              }

              // Reset form
              this.reset();
              if (selectedServiceInput) selectedServiceInput.value = '';

              // Reset service buttons
              serviceOptions.forEach((opt) => {
                opt.style.backgroundColor = 'white';
                opt.setAttribute('data-selected', 'false');
              });
            } else {
              throw new Error('Form submission failed');
            }
          } catch (error) {
            console.error('Error submitting form:', error);
            alert(
              'Det uppstod ett fel när formuläret skickades. Vänligen försök igen.',
            );
          } finally {
            // Reset button
            if (submitBtn) {
              submitBtn.innerHTML = originalText;
              submitBtn.disabled = false;
            }
          }
        }
      });
    }
  });
{% endjavascript %}

{% schema %}
{
  "name": "Offertförfrågan",
  "tag": "section",
  "class": "section-offert-forfragan",
  "settings": [
    {
      "type": "header",
      "content": "Innehåll"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Rubrik",
      "default": "Begär offert"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Beskrivning",
      "default": "<p>Fyll i formuläret nedan så återkommer vi till dig med en skräddarsydd offert.</p>"
    },
    {
      "type": "header",
      "content": "Kort 1"
    },
    {
      "type": "image_picker",
      "id": "card_1_image",
      "label": "Bild 1"
    },
    {
      "type": "text",
      "id": "card_1_button_text",
      "label": "Knapptext 1"
    },
    {
      "type": "url",
      "id": "card_1_button_link",
      "label": "Knapplänk 1"
    },
    {
      "type": "range",
      "id": "card_1_overlay_opacity",
      "label": "Överlagring opacitet 1",
      "min": 0,
      "max": 100,
      "default": 0,
      "unit": "%"
    },
    {
      "type": "header",
      "content": "Kort 2"
    },
    {
      "type": "image_picker",
      "id": "card_2_image",
      "label": "Bild 2"
    },
    {
      "type": "text",
      "id": "card_2_button_text",
      "label": "Knapptext 2"
    },
    {
      "type": "url",
      "id": "card_2_button_link",
      "label": "Knapplänk 2"
    },
    {
      "type": "range",
      "id": "card_2_overlay_opacity",
      "label": "Överlagring opacitet 2",
      "min": 0,
      "max": 100,
      "default": 0,
      "unit": "%"
    },
    {
      "type": "header",
      "content": "Kort 3"
    },
    {
      "type": "image_picker",
      "id": "card_3_image",
      "label": "Bild 3"
    },
    {
      "type": "text",
      "id": "card_3_button_text",
      "label": "Knapptext 3"
    },
    {
      "type": "url",
      "id": "card_3_button_link",
      "label": "Knapplänk 3"
    },
    {
      "type": "range",
      "id": "card_3_overlay_opacity",
      "label": "Överlagring opacitet 3",
      "min": 0,
      "max": 100,
      "default": 0,
      "unit": "%"
    },
    {
      "type": "header",
      "content": "Kort 4"
    },
    {
      "type": "image_picker",
      "id": "card_4_image",
      "label": "Bild 4"
    },
    {
      "type": "text",
      "id": "card_4_button_text",
      "label": "Knapptext 4"
    },
    {
      "type": "url",
      "id": "card_4_button_link",
      "label": "Knapplänk 4"
    },
    {
      "type": "range",
      "id": "card_4_overlay_opacity",
      "label": "Överlagring opacitet 4",
      "min": 0,
      "max": 100,
      "default": 0,
      "unit": "%"
    }
  ],
  "presets": [
    {
      "name": "Offertförfrågan"
    }
  ]
}
{% endschema %}
