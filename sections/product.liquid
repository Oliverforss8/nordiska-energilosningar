{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = "section-" | append: section.type
%}

<section
  id='{{ section_id }}'
  class='{{ section_class }} '
>
  <div class='layout pt-[150px]'>
    <div class=' flex flex-row gap-[50px]'>
      <!-- Product Images -->
      <div class='space-y-4'>
        <div class='px-[90px] py-[40px] rounded-[15px] flex bg-[#F6F6F6]'>
          {% if product.featured_media %}
            <div class='flex w-[300px] h-[300px]' id='main-product-image'>
              {%
                render 'image',
                image: product.featured_media,
                alt: product.featured_media.alt | default: product.title,
                class: 'image--cover'
              %}
            </div>
          {% endif %}
        </div>

        {% if product.media.size > 1 %}
          <div class='flex gap-3 overflow-x-auto'>
            {% for media in product.media offset: 1 limit: 4 %}
              <div
                class='flex-shrink-0 w-[80px] h-[80px] rounded-[10px] overflow-hidden bg-[#F6F6F6] cursor-pointer hover:opacity-80 transition-opacity'
                data-thumbnail
                data-media-id='{{ media.id }}'
              >
                {%
                  render 'image',
                  image: media,
                  alt: media.alt | default: product.title,
                  class: 'image--cover'
                %}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Details -->
      <div class='product-details '>
        <div class=''>
          <h1 class=' headline2'>
            {{ product.title }}
          </h1>

          {% if product.description != blank %}
            <div class='body1 py-[50px] text-[#171717]/80'>
              {{ product.description }}
            </div>
          {% endif %}

          <div class='flex items-center space-x-3'>
            {% if product.compare_at_price > product.price %}
              <span class='text-lg text-gray-500 line-through'>
                {{ product.compare_at_price | money }}
              </span>
            {% endif %}
            <span class=' headline2'>
              {{ product.price | money }}
            </span>
          </div>
          <div class='pt-[50px] flex flex-row gap-[10px]'>
            <button
              class='headline1 text-[20px] bg-transparent rounded-[10px]  pl-[20px] pr-[15px] py-[15px] gap-[10px] flex flex-row items-center'
              style='border: 1px solid #171717 !important;'
            >
              1
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='13'
                height='18'
                viewBox='0 0 13 18'
                fill='none'
              >
                <path d="M11.7159 6.71C11.8096 6.61704 11.884 6.50644 11.9348 6.38458C11.9856 6.26272 12.0117 6.13201 12.0117 6C12.0117 5.86799 11.9856 5.73728 11.9348 5.61542C11.884 5.49356 11.8096 5.38296 11.7159 5.29L6.71592 0.29C6.62296 0.196272 6.51236 0.121877 6.3905 0.0711086C6.26864 0.0203399 6.13793 -0.00579834 6.00592 -0.00579834C5.87391 -0.00579834 5.7432 0.0203399 5.62134 0.0711086C5.49948 0.121877 5.38888 0.196272 5.29592 0.29L0.295921 5.29C0.202193 5.38296 0.127797 5.49356 0.0770283 5.61542C0.0262594 5.73728 0.00012207 5.86799 0.00012207 6C0.00012207 6.13201 0.0262594 6.26272 0.0770283 6.38458C0.127797 6.50644 0.202193 6.61704 0.295921 6.71C0.388885 6.80373 0.499484 6.87812 0.621344 6.92889C0.743203 6.97966 0.873909 7.0058 1.00592 7.0058C1.13793 7.0058 1.26864 6.97966 1.3905 6.92889C1.51236 6.87812 1.62296 6.80373 1.71592 6.71L6.00592 2.41L10.2959 6.71C10.3889 6.80373 10.4995 6.87812 10.6213 6.92889C10.7432 6.97966 10.8739 7.0058 11.0059 7.0058C11.1379 7.0058 11.2686 6.97966 11.3905 6.92889C11.5124 6.87812 11.623 6.80373 11.7159 6.71ZM6.71592 17.71L11.7159 12.71C11.8092 12.6168 11.8831 12.5061 11.9336 12.3842C11.984 12.2624 12.01 12.1319 12.01 12C12.01 11.7337 11.9042 11.4783 11.7159 11.29C11.6227 11.1968 11.512 11.1228 11.3902 11.0723C11.2683 11.0219 11.1378 10.9959 11.0059 10.9959C10.7396 10.9959 10.4842 11.1017 10.2959 11.29L6.00592 15.59L1.71592 11.29C1.62296 11.1963 1.51236 11.1219 1.3905 11.0711C1.26864 11.0203 1.13793 10.9942 1.00592 10.9942C0.873909 10.9942 0.743203 11.0203 0.621344 11.0711C0.499484 11.1219 0.388885 11.1963 0.295921 11.29C0.202193 11.383 0.127797 11.4936 0.0770283 11.6154C0.0262594 11.7373 0.00012207 11.868 0.00012207 12C0.00012207 12.132 0.0262594 12.2627 0.0770283 12.3846C0.127797 12.5064 0.202193 12.617 0.295921 12.71L5.29592 17.71C5.38888 17.8037 5.49948 17.8781 5.62134 17.9289C5.7432 17.9797 5.87391 18.0058 6.00592 18.0058C6.13793 18.0058 6.26864 17.9797 6.3905 17.9289C6.51236 17.8781 6.62296 17.8037 6.71592 17.71Z" fill="#171717"/>
              </svg>
            </button>
            <button
              class='px-[20px] flex flex-row gap-[20px] items-center rounded-[10px] py-[17px] knappetikett text-[#171717] '
              style='background: linear-gradient(0deg, rgba(255, 255, 255, 0.20) 0%, rgba(255, 255, 255, 0.20) 100%), #EBCF2F;'
            >
              Köp nu
            </button>
            <button
              class='headline1 text-[20px] bg-transparent rounded-[10px]  px-[20px] py-[15px] gap-[10px] flex flex-row items-center'
              style='border: 1px solid #171717 !important;'
            >
              Lägg i varukorg
              <svg
                xmlns='http://www.w3.org/2000/svg'
                width='25'
                height='22'
                viewBox='0 0 25 22'
                fill='none'
              >
                <path d="M11.4617 6.55556H21.0268C21.7143 6.55556 22.0575 6.55556 22.3094 6.66667C23.4225 7.16333 22.9253 8.41111 22.7383 9.30889C22.7209 9.39 22.685 9.46588 22.6334 9.5305C22.5819 9.59512 22.5161 9.64669 22.4413 9.68111C22.0849 9.85113 21.7802 10.1148 21.5592 10.4444M7.06199 6.55556H2.99662C2.30915 6.55556 1.96597 6.55556 1.71409 6.66667C0.600948 7.16333 1.09812 8.41111 1.28511 9.30889C1.30331 9.38967 1.33953 9.46519 1.39099 9.52969C1.44246 9.59419 1.50782 9.64598 1.58209 9.68111C1.89053 9.82463 2.16039 10.0408 2.36901 10.3115C2.57763 10.5821 2.71892 10.8994 2.78103 11.2367L3.43329 14.9867C3.71928 16.6367 3.81827 18.9933 5.24819 20.1556C6.29863 21 7.81105 21 10.837 21H13.6616M16.4115 16C16.9515 15.4378 18.3914 13.2222 19.1613 13.2222M19.1613 13.2222C19.9313 13.2222 21.3711 15.4378 21.9112 16M19.1613 13.2222V21M5.96205 9.88889L9.81184 1M15.3115 1L18.0614 6.55556" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>

          <!-- Additional Text Fields -->
          {% if product.metafields.custom.meta_falt_texter %}
            {% assign texter_metaobject = product.metafields.custom.meta_falt_texter.value %}

            <div class='pt-[50px] flex flex-row gap-[20px]'>
              {% if texter_metaobject.text_1 != blank %}
                <div class='text-field w-full bg-[#F3F1E8] p-[30px] rounded-[15px]'>
                  <div class='metafield-content'>
                    {% assign text_1_data = texter_metaobject.text_1.value %}
                    {% for child in text_1_data.children %}
                      {% if child.type == "heading" %}
                        {% if child.level == 2 %}
                          <h2>{{ child.children[0].value }}</h2>
                        {% elsif child.level == 3 %}
                          <h3>{{ child.children[0].value }}</h3>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              {% if texter_metaobject.text_2 != blank %}
                <div class='text-field w-full bg-[#F3F1E8] p-[30px] rounded-[15px]'>
                  <div class='metafield-content'>
                    {% assign text_2_data = texter_metaobject.text_2.value %}
                    {% for child in text_2_data.children %}
                      {% if child.type == "heading" %}
                        {% if child.level == 2 %}
                          <h2>{{ child.children[0].value }}</h2>
                        {% elsif child.level == 3 %}
                          <h3>{{ child.children[0].value }}</h3>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              {% if texter_metaobject.text_3 != blank %}
                <div class='text-field bg-[#F3F1E8] w-full p-[30px] rounded-[15px]'>
                  <div class='metafield-content'>
                    {% assign text_3_data = texter_metaobject.text_3.value %}
                    {% for child in text_3_data.children %}
                      {% if child.type == "heading" %}
                        {% if child.level == 2 %}
                          <h2>{{ child.children[0].value }}</h2>
                        {% elsif child.level == 3 %}
                          <h3>{{ child.children[0].value }}</h3>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
          {% endif %}

          <div class='pt-[50px]'>
            <!-- Tekniska specifikationer Dropdown -->
            <div class='dropdown-section'>
              <div
                class='flex flex-row w-full py-[20px] justify-between items-center cursor-pointer dropdown-trigger'
                style='border-top: 1px solid #171717; border-bottom: 1px solid #171717;'
                onclick='toggleDropdown("specs-content", this)'
              >
                <div class=' body1'>Tekniska specifikationer</div>
                <div class='dropdown-icon'>
                  <svg
                    xmlns='http://www.w3.org/2000/svg'
                    width='16'
                    height='16'
                    viewBox='0 0 16 16'
                    fill='none'
                  >
                    <path d="M1 8H15M8 1V15" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
              <div
                class='dropdown-content'
                id='specs-content'
                style='display: none;'
              >
                <div class='py-[20px]'>
                  {% if product.metafields.custom.tekniska_specifikationer
                      != blank
                  %}
                    <div class='prose prose-sm max-w-none'>
                      {{
                        product.metafields.custom.tekniska_specifikationer
                        | metafield_text
                      }}
                    </div>
                  {% else %}
                    <p class='text-gray-500'>
                      Inga tekniska specifikationer tillgängliga.
                    </p>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Mer information Dropdown -->
            <div class='dropdown-section'>
              <div
                class='flex flex-row w-full py-[20px] justify-between items-center cursor-pointer dropdown-trigger'
                style='border-bottom: 1px solid #171717;'
                onclick='toggleDropdown("info-content", this)'
              >
                <div class=' body1'>Mer information</div>
                <div class='dropdown-icon'>
                  <svg
                    xmlns='http://www.w3.org/2000/svg'
                    width='16'
                    height='16'
                    viewBox='0 0 16 16'
                    fill='none'
                  >
                    <path d="M1 8H15M8 1V15" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
              <div
                class='dropdown-content'
                id='info-content'
                style='display: none;'
              >
                <div class='py-[20px]'>
                  {% if product.metafields.custom.mer_text != blank %}
                    <div class='prose prose-sm max-w-none'>
                      {{ product.metafields.custom.mer_text | metafield_text }}
                    </div>
                  {% else %}
                    <p class='text-gray-500'>
                      Ingen ytterligare information tillgänglig.
                    </p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% stylesheet %}
  /* Make images passed with class image--cover fill and cover wrappers */
  .image.image--cover {
    width: 100%;
    height: 100%;
  }
  .image.image--cover > img {
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important;
  }

  /* Thumbnail active state */
  [data-thumbnail].active {
    opacity: 1 !important;
    border: 3px solid #171717 !important;
    transform: scale(1.05) !important;
    box-shadow: 0 4px 12px rgba(23, 23, 23, 0.2) !important;
  }

  /* Thumbnail hover state */
  [data-thumbnail]:hover:not(.active) {
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(23, 23, 23, 0.15);
  }

  /* Smooth transitions for all thumbnail states */
  [data-thumbnail] {
    transition: all 0.3s ease;
  }

  /* Override hover opacity when active */
  [data-thumbnail].active:hover {
    opacity: 1 !important;
  }

  /* Metafield content styling - target H2 and H3 in rich text */
  .metafield-content h2 {
    font-size: 40px !important;
    line-height: 0.9 !important;
    margin: 0 0 16px 0 !important;
    font-weight: 400 !important;
    color: #171717 !important;
    display: block !important;
    font-family: var(--font-halyard--family);
  }

  .metafield-content h3 {
    font-size: 20px !important;
    line-height: 0.9 !important;
    margin: 0 0 30px 0 !important;
    font-weight: 400 !important;
    color: #171717 !important;
    font-family: var(--font-halyard--family);
  }

  .metafield-content p {
    margin: 0 0 12px 0 !important;
    color: #171717 !important;
    opacity: 0.8;
    display: block !important;
  }

  .metafield-content ul,
  .metafield-content ol {
    margin: 0 0 12px 0 !important;
    padding-left: 20px !important;
    display: block !important;
  }

  .metafield-content li {
    margin: 0 0 6px 0 !important;
    color: #171717 !important;
    opacity: 0.8;
    display: list-item !important;
  }

  /* Ensure proper spacing between elements */
  .metafield-content > *:last-child {
    margin-bottom: 0 !important;
  }

  /* Dropdown styling */
  .dropdown-trigger {
    transition: all 0.3s ease;
  }

  .dropdown-trigger:hover {
    background-color: rgba(23, 23, 23, 0.05);
  }

  .dropdown-icon {
    transition: transform 0.3s ease;
  }

  .dropdown-trigger.active .dropdown-icon {
    transform: rotate(45deg);
  }

  .dropdown-content {
    overflow: hidden;
    transition: all 0.3s ease;
    border-bottom: 1px solid #171717;
  }

  .dropdown-content.show {
    display: block !important;
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const mainImageContainer = document.getElementById('main-product-image');
    const thumbnails = document.querySelectorAll('[data-thumbnail]');

    if (!mainImageContainer || thumbnails.length === 0) return;

    // Store all product media for easy access
    const productMedia = [
      {% for media in product.media %}
        {
          id: {{ media.id }},
          alt: {{ media.alt | default: product.title | json }},
          src: {{ media | image_url: width: 600 | json }},
          {% if forloop.first %}isFeatured: true{% else %}isFeatured: false{% endif %}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];

    // Function to update main image
    function updateMainImage(mediaId) {
      const media = productMedia.find(m => m.id === mediaId);
      if (!media) return;

      // Update the image source
      const img = mainImageContainer.querySelector('img');
      if (img) {
        img.src = media.src;
        img.alt = media.alt;
      }

      // Update active thumbnail
      thumbnails.forEach(thumb => {
        thumb.classList.remove('active');
        if (parseInt(thumb.dataset.mediaId) === mediaId) {
          thumb.classList.add('active');
          console.log('Added active class to thumbnail:', thumb); // Debug
        }
      });
    }

    // Add click listeners to thumbnails
    thumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', function() {
        const mediaId = parseInt(this.dataset.mediaId);
        updateMainImage(mediaId);
      });
    });

    // Set initial active state for featured image
    if (productMedia.length > 0) {
      const featuredMedia = productMedia.find(m => m.isFeatured);
      if (featuredMedia) {
        // Find the thumbnail that corresponds to the featured image
        const featuredThumbnail = Array.from(thumbnails).find(thumb =>
          parseInt(thumb.dataset.mediaId) === featuredMedia.id
        );

        if (featuredThumbnail) {
          featuredThumbnail.classList.add('active');
        }
      }
    }

  });

  // Simple dropdown function - must be global for onclick to work
  window.toggleDropdown = function(contentId, trigger) {
    console.log('Toggle dropdown called:', contentId); // Debug

    const content = document.getElementById(contentId);
    const icon = trigger.querySelector('.dropdown-icon');

    if (content) {
      const isHidden = content.style.display === 'none' || content.style.display === '';

      if (isHidden) {
        content.style.display = 'block';
        content.classList.add('show');
        trigger.classList.add('active');
        if (icon) icon.style.transform = 'rotate(45deg)';
        console.log('Opened dropdown:', contentId);
      } else {
        content.style.display = 'none';
        content.classList.remove('show');
        trigger.classList.remove('active');
        if (icon) icon.style.transform = 'rotate(0deg)';
        console.log('Closed dropdown:', contentId);
      }
    } else {
      console.error('Content not found:', contentId);
    }
  }
{% endjavascript %}

{% schema %}
{
  "name": "sections.product.name",
  "tag": "section",
  "class": "product-section",
  "settings": [
    {
      "type": "text",
      "id": "custom_id",
      "label": "t:settings.custom_id",
      "info": "t:settings.custom_id_info"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "t:settings.padding_top",
      "min": 0,
      "max": 100,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "t:settings.padding_bottom",
      "min": 0,
      "max": 100,
      "default": 40,
      "unit": "px"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "presets": [
    {
      "name": "t:sections.product.name"
    }
  ]
}
{% endschema %}
