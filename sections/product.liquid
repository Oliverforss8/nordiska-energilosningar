{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = "section-" | append: section.type
%}

<section
  id='{{ section_id }}'
  class='{{ section_class }} '
>
  <div class='layout pt-[100px] md:pt-[150px] '>
    <div class='flex flex-col md:flex-row gap-[30px] md:gap-[50px]'>
      <!-- Product Images -->
      <div class='space-y-4 w-full md:w-auto'>
        <div class='px-[20px] py-[20px] md:px-[90px] md:py-[40px] rounded-[15px] flex bg-[#F6F6F6]'>
          {% if product.featured_media %}
            <div
              class='flex w-full h-[280px] md:w-[300px] md:h-[300px]'
              id='main-product-image'
            >
              {%
                render 'image',
                image: product.featured_media,
                alt: product.featured_media.alt | default: product.title,
                class: 'image--cover'
              %}
            </div>
          {% endif %}
        </div>

        {% if product.media.size > 1 %}
          <div class='flex gap-3 overflow-x-auto pb-2'>
            {% for media in product.media offset: 1 limit: 4 %}
              <div
                class='flex-shrink-0 w-[60px] h-[60px] md:w-[80px] md:h-[80px] rounded-[10px] overflow-hidden bg-[#F6F6F6] cursor-pointer hover:opacity-80 transition-opacity'
                data-thumbnail
                data-media-id='{{ media.id }}'
              >
                {%
                  render 'image',
                  image: media,
                  alt: media.alt | default: product.title,
                  class: 'image--cover'
                %}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Details -->
      <div class='product-details w-full'>
        <div class=''>
          <h1 class=' headline2'>
            {{ product.title }}
          </h1>

          {% if product.description != blank %}
            <div class='body1 py-[30px] md:py-[50px] text-[#171717]/80'>
              {{ product.description }}
            </div>
          {% endif %}

          <div class='flex items-center space-x-3 mb-[30px] md:mb-0'>
            {% if product.compare_at_price > product.price %}
              <span class='text-lg text-gray-500 line-through'>
                {{ product.compare_at_price | money }}
              </span>
            {% endif %}
            <span class='headline2'>
              {{ product.price | money }}
            </span>
          </div>

          <!-- Mobile-optimized button layout -->
          <div class=''>
            <!-- Quantity selector -->
            <div class='flex md:hidden justify-start'>
              <div
                class='headline1 text-[18px] md:text-[20px] bg-transparent rounded-[10px] pl-[20px] pr-[15px] py-[10px] gap-[10px] flex flex-row items-center min-h-[48px]'
                style='border: 1px solid #171717 !important;'
              >
                <span id='quantity-display'>1</span>
                <div class='flex flex-col gap-[0px] cursor-pointer'>
                  <!-- Up arrow (increase) -->
                  <button
                    type='button'
                    class='quantity-increase hover:opacity-70 transition-opacity'
                    onclick='updateQuantity(1)'
                    style='background: none; border: none; padding: 0; cursor: pointer;'
                  >
                    <svg
                      xmlns='http://www.w3.org/2000/svg'
                      width='13'
                      height='9'
                      viewBox='0 0 13 9'
                      fill='none'
                    >
                      <path d="M11.7159 6.71C11.8096 6.61704 11.884 6.50644 11.9348 6.38458C11.9856 6.26272 12.0117 6.13201 12.0117 6C12.0117 5.86799 11.9856 5.73728 11.9348 5.61542C11.884 5.49356 11.8096 5.38296 11.7159 5.29L6.71592 0.29C6.62296 0.196272 6.51236 0.121877 6.3905 0.0711086C6.26864 0.0203399 6.13793 -0.00579834 6.00592 -0.00579834C5.87391 -0.00579834 5.7432 0.0203399 5.62134 0.0711086C5.49948 0.121877 5.38888 0.196272 5.29592 0.29L0.295921 5.29C0.202193 5.38296 0.127797 5.49356 0.0770283 5.61542C0.0262594 5.73728 0.00012207 5.86799 0.00012207 6C0.00012207 6.13201 0.0262594 6.26272 0.0770283 6.38458C0.127797 6.50644 0.202193 6.61704 0.295921 6.71C0.388885 6.80373 0.499484 6.87812 0.621344 6.92889C0.743203 6.97966 0.873909 7.0058 1.00592 7.0058C1.13793 7.0058 1.26864 6.97966 1.3905 6.92889C1.51236 6.87812 1.62296 6.80373 1.71592 6.71L6.00592 2.41L10.2959 6.71C10.3889 6.80373 10.4995 6.87812 10.6213 6.92889C10.7432 6.97966 10.8739 7.0058 11.0059 7.0058C11.1379 7.0058 11.2686 6.97966 11.3905 6.92889C11.5124 6.87812 11.623 6.80373 11.7159 6.71Z" fill="#171717"/>
                    </svg>
                  </button>

                  <!-- Down arrow (decrease) -->
                  <button
                    type='button'
                    class='quantity-decrease hover:opacity-70 transition-opacity'
                    onclick='updateQuantity(-1)'
                    style='background: none; border: none; padding: 0; cursor: pointer;'
                  >
                    <svg
                      xmlns='http://www.w3.org/2000/svg'
                      width='13'
                      height='9'
                      viewBox='0 0 13 9'
                      fill='none'
                    >
                      <path d="M6.71592 8.71L11.7159 3.71C11.8092 3.6168 11.8831 3.5061 11.9336 3.3842C11.984 3.2624 12.01 3.1319 12.01 3C12.01 2.7337 11.9042 2.4783 11.7159 2.29C11.6227 2.1968 11.512 2.1228 11.3902 2.0723C11.2683 2.0219 11.1378 1.9959 11.0059 1.9959C10.7396 1.9959 10.4842 2.1017 10.2959 2.29L6.00592 6.59L1.71592 2.29C1.62296 2.1963 1.51236 2.1219 1.3905 2.0711C1.26864 2.0203 1.13793 1.9942 1.00592 1.9942C0.873909 1.9942 0.743203 2.0203 0.621344 2.0711C0.499484 2.1219 0.388885 2.1963 0.295921 2.29C0.202193 2.383 0.127797 2.4936 0.0770283 2.6154C0.0262594 2.7373 0.00012207 2.868 0.00012207 3C0.00012207 3.132 0.0262594 3.2627 0.0770283 3.3846C0.127797 3.5064 0.202193 3.617 0.295921 3.71L5.29592 8.71C5.38888 8.8037 5.49948 8.8781 5.62134 8.9289C5.7432 8.9797 5.87391 9.0058 6.00592 9.0058C6.13793 9.0058 6.26864 8.9797 6.3905 8.9289C6.51236 8.8781 6.62296 8.8037 6.71592 8.71Z" fill="#171717"/>
                    </svg>
                  </button>
                </div>

                <!-- Hidden input to store the actual quantity -->
                <input
                  type='hidden'
                  id='quantity-input'
                  value='1'
                  min='1'
                  max='{{ product.selected_or_first_available_variant.inventory_quantity | default: 99 }}'
                >
              </div>
            </div>

            <!-- Action buttons - stacked on mobile, row on desktop -->
            <div class='flex md:pt-[50px] flex-col md:flex-row gap-[10px] w-full'>
              <div class='flex justify-center md:justify-start'>
                <div
                  class='headline1 text-[18px] md:text-[20px] bg-transparent rounded-[10px] pl-[20px] md:flex hidden pr-[15px] py-[15px] gap-[10px] flex flex-row items-center min-h-[48px]'
                  style='border: 1px solid #171717 !important;'
                >
                  <span id='quantity-display'>1</span>
                  <div class='flex flex-col gap-[2px] cursor-pointer'>
                    <!-- Up arrow (increase) -->
                    <button
                      type='button'
                      class='quantity-increase hover:opacity-70 transition-opacity'
                      onclick='updateQuantity(1)'
                      style='background: none; border: none; padding: 0; cursor: pointer;'
                    >
                      <svg
                        xmlns='http://www.w3.org/2000/svg'
                        width='13'
                        height='9'
                        viewBox='0 0 13 9'
                        fill='none'
                      >
                        <path d="M11.7159 6.71C11.8096 6.61704 11.884 6.50644 11.9348 6.38458C11.9856 6.26272 12.0117 6.13201 12.0117 6C12.0117 5.86799 11.9856 5.73728 11.9348 5.61542C11.884 5.49356 11.8096 5.38296 11.7159 5.29L6.71592 0.29C6.62296 0.196272 6.51236 0.121877 6.3905 0.0711086C6.26864 0.0203399 6.13793 -0.00579834 6.00592 -0.00579834C5.87391 -0.00579834 5.7432 0.0203399 5.62134 0.0711086C5.49948 0.121877 5.38888 0.196272 5.29592 0.29L0.295921 5.29C0.202193 5.38296 0.127797 5.49356 0.0770283 5.61542C0.0262594 5.73728 0.00012207 5.86799 0.00012207 6C0.00012207 6.13201 0.0262594 6.26272 0.0770283 6.38458C0.127797 6.50644 0.202193 6.61704 0.295921 6.71C0.388885 6.80373 0.499484 6.87812 0.621344 6.92889C0.743203 6.97966 0.873909 7.0058 1.00592 7.0058C1.13793 7.0058 1.26864 6.97966 1.3905 6.92889C1.51236 6.87812 1.62296 6.80373 1.71592 6.71L6.00592 2.41L10.2959 6.71C10.3889 6.80373 10.4995 6.87812 10.6213 6.92889C10.7432 6.97966 10.8739 7.0058 11.0059 7.0058C11.1379 7.0058 11.2686 6.97966 11.3905 6.92889C11.5124 6.87812 11.623 6.80373 11.7159 6.71Z" fill="#171717"/>
                      </svg>
                    </button>

                    <!-- Down arrow (decrease) -->
                    <button
                      type='button'
                      class='quantity-decrease hover:opacity-70 transition-opacity'
                      onclick='updateQuantity(-1)'
                      style='background: none; border: none; padding: 0; cursor: pointer;'
                    >
                      <svg
                        xmlns='http://www.w3.org/2000/svg'
                        width='13'
                        height='9'
                        viewBox='0 0 13 9'
                        fill='none'
                      >
                        <path d="M6.71592 8.71L11.7159 3.71C11.8092 3.6168 11.8831 3.5061 11.9336 3.3842C11.984 3.2624 12.01 3.1319 12.01 3C12.01 2.7337 11.9042 2.4783 11.7159 2.29C11.6227 2.1968 11.512 2.1228 11.3902 2.0723C11.2683 2.0219 11.1378 1.9959 11.0059 1.9959C10.7396 1.9959 10.4842 2.1017 10.2959 2.29L6.00592 6.59L1.71592 2.29C1.62296 2.1963 1.51236 2.1219 1.3905 2.0711C1.26864 2.0203 1.13793 1.9942 1.00592 1.9942C0.873909 1.9942 0.743203 2.0203 0.621344 2.0711C0.499484 2.1219 0.388885 2.1963 0.295921 2.29C0.202193 2.383 0.127797 2.4936 0.0770283 2.6154C0.0262594 2.7373 0.00012207 2.868 0.00012207 3C0.00012207 3.132 0.0262594 3.2627 0.0770283 3.3846C0.127797 3.5064 0.202193 3.617 0.295921 3.71L5.29592 8.71C5.38888 8.8037 5.49948 8.8781 5.62134 8.9289C5.7432 8.9797 5.87391 9.0058 6.00592 9.0058C6.13793 9.0058 6.26864 8.9797 6.3905 8.9289C6.51236 8.8781 6.62296 8.8037 6.71592 8.71Z" fill="#171717"/>
                      </svg>
                    </button>
                  </div>

                  <!-- Hidden input to store the actual quantity -->
                  <input
                    type='hidden'
                    id='quantity-input'
                    value='1'
                    min='1'
                    max='{{ product.selected_or_first_available_variant.inventory_quantity | default: 99 }}'
                  >
                </div>
              </div>
              <button
                class='w-full md:w-auto px-[20px] flex flex-row gap-[20px] items-center justify-center rounded-[10px] py-[17px] knappetikett text-[#171717] buy-now-btn min-h-[48px]'
                style='background: linear-gradient(0deg, rgba(255, 255, 255, 0.20) 0%, rgba(255, 255, 255, 0.20) 100%), #EBCF2F;'
                data-variant-id='{{ product.selected_or_first_available_variant.id }}'
              >
                Köp nu
              </button>
              <button
                class='w-full md:w-auto headline1 text-[18px] md:text-[20px] bg-transparent rounded-[10px] px-[20px] py-[15px] gap-[10px] flex flex-row items-center justify-center add-to-cart-btn min-h-[48px]'
                style='border: 1px solid #171717 !important;'
                data-variant-id='{{ product.selected_or_first_available_variant.id }}'
              >
                Lägg i varukorg
                <svg
                  xmlns='http://www.w3.org/2000/svg'
                  width='20'
                  height='18'
                  viewBox='0 0 25 22'
                  fill='none'
                  class='md:w-[25px] md:h-[22px]'
                >
                  <path d="M11.4617 6.55556H21.0268C21.7143 6.55556 22.0575 6.55556 22.3094 6.66667C23.4225 7.16333 22.9253 8.41111 22.7383 9.30889C22.7209 9.39 22.685 9.46588 22.6334 9.5305C22.5819 9.59512 22.5161 9.64669 22.4413 9.68111C22.0849 9.85113 21.7802 10.1148 21.5592 10.4444M7.06199 6.55556H2.99662C2.30915 6.55556 1.96597 6.55556 1.71409 6.66667C0.600948 7.16333 1.09812 8.41111 1.28511 9.30889C1.30331 9.38967 1.33953 9.46519 1.39099 9.52969C1.44246 9.59419 1.50782 9.64598 1.58209 9.68111C1.89053 9.82463 2.16039 10.0408 2.36901 10.3115C2.57763 10.5821 2.71892 10.8994 2.78103 11.2367L3.43329 14.9867C3.71928 16.6367 3.81827 18.9933 5.24819 20.1556C6.29863 21 7.81105 21 10.837 21H13.6616M16.4115 16C16.9515 15.4378 18.3914 13.2222 19.1613 13.2222M19.1613 13.2222C19.9313 13.2222 21.3711 15.4378 21.9112 16M19.1613 13.2222V21M5.96205 9.88889L9.81184 1M15.3115 1L18.0614 6.55556" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Additional Text Fields -->
          {% if product.metafields.custom.meta_falt_texter %}
            {% assign texter_metaobject = product.metafields.custom.meta_falt_texter.value %}

            <div class='pt-[30px] md:pt-[50px] flex flex-col md:flex-row gap-[15px] md:gap-[20px]'>
              {% if texter_metaobject.text_1 != blank %}
                <div class='text-field w-full bg-[#F3F1E8] p-[20px] md:p-[30px] rounded-[15px]'>
                  <div class='metafield-content'>
                    {% assign text_1_data = texter_metaobject.text_1.value %}
                    {% for child in text_1_data.children %}
                      {% if child.type == "heading" %}
                        {% if child.level == 2 %}
                          <h2>{{ child.children[0].value }}</h2>
                        {% elsif child.level == 3 %}
                          <h3>{{ child.children[0].value }}</h3>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              {% if texter_metaobject.text_2 != blank %}
                <div class='text-field w-full bg-[#F3F1E8] p-[20px] md:p-[30px] rounded-[15px]'>
                  <div class='metafield-content'>
                    {% assign text_2_data = texter_metaobject.text_2.value %}
                    {% for child in text_2_data.children %}
                      {% if child.type == "heading" %}
                        {% if child.level == 2 %}
                          <h2>{{ child.children[0].value }}</h2>
                        {% elsif child.level == 3 %}
                          <h3>{{ child.children[0].value }}</h3>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              {% if texter_metaobject.text_3 != blank %}
                <div class='text-field bg-[#F3F1E8] w-full p-[20px] md:p-[30px] rounded-[15px]'>
                  <div class='metafield-content'>
                    {% assign text_3_data = texter_metaobject.text_3.value %}
                    {% for child in text_3_data.children %}
                      {% if child.type == "heading" %}
                        {% if child.level == 2 %}
                          <h2>{{ child.children[0].value }}</h2>
                        {% elsif child.level == 3 %}
                          <h3>{{ child.children[0].value }}</h3>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
          {% endif %}

          <div class='pt-[30px] md:pt-[50px]'>
            <!-- Tekniska specifikationer Dropdown -->
            <div
              class='dropdown-section'
              style='border-top: 1px solid #171717; border-bottom: 1px solid #171717;'
            >
              <div
                class='flex flex-row w-full py-[16px] md:py-[20px] justify-between items-center cursor-pointer dropdown-trigger min-h-[48px]'
                onclick='toggleDropdown("specs-content", this)'
              >
                <div class='body1 text-[18px] md:text-[24px]'>
                  Tekniska specifikationer
                </div>
                <div class='dropdown-icon p-2'>
                  <svg
                    xmlns='http://www.w3.org/2000/svg'
                    width='16'
                    height='16'
                    viewBox='0 0 16 16'
                    fill='none'
                  >
                    <path d="M1 8H15M8 1V15" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
              <div
                class='dropdown-content'
                id='specs-content'
                style='display: none; padding-top: 16px; padding-bottom: 16px;'
              >
                {% if product.metafields.custom.tekniska_specifikationer
                    != blank
                %}
                  <div class='body1 text-[14px] md:text-[16px]'>
                    {{
                      product.metafields.custom.tekniska_specifikationer
                      | metafield_text
                    }}
                  </div>
                {% else %}
                  <p class='body1 text-[14px] md:text-[16px]'>
                    Inga tekniska specifikationer tillgängliga.
                  </p>
                {% endif %}
              </div>
            </div>

            <!-- Mer information Dropdown -->
            <div
              class='dropdown-section'
              style='border-bottom: 1px solid #171717;'
            >
              <div
                class='flex flex-row w-full py-[16px] md:py-[20px] justify-between items-center cursor-pointer dropdown-trigger min-h-[48px]'
                onclick='toggleDropdown("info-content", this)'
              >
                <div class='body1 text-[18px] md:text-[24px]'>
                  Mer information
                </div>
                <div class='dropdown-icon p-2'>
                  <svg
                    xmlns='http://www.w3.org/2000/svg'
                    width='16'
                    height='16'
                    viewBox='0 0 16 16'
                    fill='none'
                  >
                    <path d="M1 8H15M8 1V15" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
              <div
                class='dropdown-content'
                id='info-content'
                style='display: none; padding-top: 16px; padding-bottom: 16px;'
              >
                {% if product.metafields.custom.mer_text != blank %}
                  <div class='body1 text-[14px] md:text-[16px]'>
                    {{ product.metafields.custom.mer_text | metafield_text }}
                  </div>
                {% else %}
                  <p class='body1 text-[14px] md:text-[16px]'>
                    Ingen ytterligare information tillgänglig.
                  </p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Cart Drawer -->
{% render "cart-drawer" %}

{% stylesheet %}
  /* Make images passed with class image--cover fill and cover wrappers */
  .image.image--cover {
    width: 100%;
    height: 100%;
  }
  .image.image--cover > img {
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important;
  }

  /* Thumbnail active state */
  [data-thumbnail].active {
    opacity: 1 !important;
    border: 3px solid #171717 !important;
    transform: scale(1.05) !important;
    box-shadow: 0 4px 12px rgba(23, 23, 23, 0.2) !important;
  }

  /* Thumbnail hover state */
  [data-thumbnail]:hover:not(.active) {
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(23, 23, 23, 0.15);
  }

  /* Smooth transitions for all thumbnail states */
  [data-thumbnail] {
    transition: all 0.3s ease;
  }

  /* Override hover opacity when active */
  [data-thumbnail].active:hover {
    opacity: 1 !important;
  }

  /* Metafield content styling - target H2 and H3 in rich text */
  .metafield-content h2 {
    font-size: 40px !important;
    line-height: 0.9 !important;
    margin: 0 0 16px 0 !important;
    font-weight: 400 !important;
    color: #171717 !important;
    display: block !important;
    font-family: var(--font-halyard--family);
  }

  .metafield-content h3 {
    font-size: 20px !important;
    line-height: 0.9 !important;
    margin: 0 0 30px 0 !important;
    font-weight: 400 !important;
    color: #171717 !important;
    font-family: var(--font-halyard--family);
  }

  .metafield-content p {
    margin: 0 0 12px 0 !important;
    color: #171717 !important;
    opacity: 0.8;
    display: block !important;
    font-family: var(--font-halyard--family);
  }

  .metafield-content ul,
  .metafield-content ol {
    margin: 0 0 12px 0 !important;
    padding-left: 20px !important;
    display: block !important;
  }

  .metafield-content li {
    margin: 0 0 6px 0 !important;
    color: #171717 !important;
    opacity: 0.8;
    display: list-item !important;
  }

  /* Ensure proper spacing between elements */
  .metafield-content > *:last-child {
    margin-bottom: 0 !important;
  }

  /* Dropdown styling */
  .dropdown-trigger {
    transition: all 0.3s ease;
  }

  .dropdown-icon {
    transition: transform 0.3s ease;
  }

  .dropdown-trigger.active .dropdown-icon {
    transform: rotate(45deg);
  }

  .dropdown-content {
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .dropdown-content.show {
    display: block !important;
  }
{% endstylesheet %}

{% javascript %}
  // Global dropdown toggle function for mobile-friendly interaction
  function toggleDropdown(contentId, trigger) {
    const content = document.getElementById(contentId);
    const icon = trigger.querySelector('.dropdown-icon');

    if (content.style.display === 'none' || content.style.display === '') {
      content.style.display = 'block';
      content.classList.add('show');
      trigger.classList.add('active');
    } else {
      content.style.display = 'none';
      content.classList.remove('show');
      trigger.classList.remove('active');
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const mainImageContainer = document.getElementById('main-product-image');
    const thumbnails = document.querySelectorAll('[data-thumbnail]');

    if (mainImageContainer && thumbnails.length > 0) {
      // Store all product media for easy access
      const productMedia = [
        {% for media in product.media %}
          {
            id: {{ media.id }},
            alt: {{ media.alt | default: product.title | json }},
            src: {{ media | image_url: width: 600 | json }},
            {% if forloop.first %}isFeatured: true{% else %}isFeatured: false{% endif %}
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ];

      // Function to update main image
      function updateMainImage(mediaId) {
        const media = productMedia.find(m => m.id === mediaId);
        if (!media) return;

        // Update the image source
        const img = mainImageContainer.querySelector('img');
        if (img) {
          img.src = media.src;
          img.alt = media.alt;
        }

        // Update active thumbnail
        thumbnails.forEach(thumb => {
          thumb.classList.remove('active');
          if (parseInt(thumb.dataset.mediaId) === mediaId) {
            thumb.classList.add('active');
          }
        });
      }

      // Add click listeners to thumbnails
      thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
          const mediaId = parseInt(this.dataset.mediaId);
          updateMainImage(mediaId);
        });
      });

      // Set initial active state for featured image
      if (productMedia.length > 0) {
        const featuredMedia = productMedia.find(m => m.isFeatured);
        if (featuredMedia) {
          const featuredThumbnail = Array.from(thumbnails).find(thumb =>
            parseInt(thumb.dataset.mediaId) === featuredMedia.id
          );

          if (featuredThumbnail) {
            featuredThumbnail.classList.add('active');
          }
        }
      }
    }

    // Buy Now functionality
    const buyNowBtn = document.querySelector('.buy-now-btn');
    if (buyNowBtn) {
      buyNowBtn.addEventListener('click', async function (e) {
        e.preventDefault();

        const variantId = this.getAttribute('data-variant-id');
        const quantity = getSelectedQuantity();

        // Show loading state
        const originalText = this.innerHTML;
        this.innerHTML = 'Behandlar...';
        this.disabled = true;

        try {
          const response = await fetch('/cart/add.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              id: variantId,
              quantity: quantity,
            }),
          });

          if (response.ok) {
            window.location.href = '/checkout';
          } else {
            throw new Error('Failed to add to cart');
          }
        } catch (error) {
          console.error('Error with buy now:', error);

          // Show error state
          this.innerHTML = 'Fel!';
          this.style.background = '#EF4444';
          this.style.color = 'white';

          // Reset button after 2 seconds
          setTimeout(() => {
            this.innerHTML = originalText;
            this.disabled = false;
            this.style.background = '';
            this.style.color = '';
          }, 2000);
        }
      });
    }
  });
{% endjavascript %}

{% schema %}
{
  "name": "Produkt",
  "presets": [
    {
      "name": "sections.product.name"
    }
  ]
}
{% endschema %}
