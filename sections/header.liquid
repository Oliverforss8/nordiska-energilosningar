{% liquid
  assign section_id = 'header-' | append: section.id

  # Check for page-specific inverted mode
  assign inverted_mode = false

  # Default inverted mode for collection, product, blog, and article pages
  if template.name == 'collection' or template.name == 'product' or template.name == 'blog' or template.name == 'article'
    assign inverted_mode = true
  endif

  # Define which pages should use inverted mode
  assign inverted_pages = section.settings.inverted_pages | split: ','

  # Check if current page/template should use inverted mode
  if template.name == 'page' and page.handle != blank
    # Check if current page handle is in the inverted pages list
    for inverted_page in inverted_pages
      assign clean_page = inverted_page | strip
      if page.handle == clean_page
        assign inverted_mode = true
        break
      endif
    endfor
  elsif template.name != 'page' and template.name != 'collection' and template.name != 'product' and template.name != 'blog' and template.name != 'article'
    # Check if current template is in the inverted pages list (excluding collection/product/blog/article which are already inverted)
    for inverted_page in inverted_pages
      assign clean_page = inverted_page | strip
      if template.name == clean_page
        assign inverted_mode = true
        break
      endif
    endfor
  endif

  # Also check global setting as fallback
  if section.settings.inverted_mode_global == true
    assign inverted_mode = true
  endif

  # URL-based inversion: match against canonical_url using comma-separated fragments
  assign inverted_url_fragments = section.settings.inverted_url_fragments | split: ','
  if inverted_url_fragments.size > 0 and inverted_mode == false
    for url_fragment in inverted_url_fragments
      assign clean_fragment = url_fragment | strip
      if clean_fragment != blank and canonical_url contains clean_fragment
        assign inverted_mode = true
        break
      endif
    endfor
  endif

  # Check if we're on a company/foretag page
  assign is_foretag_page = false
  if page.handle contains 'foretag' or template.name contains 'foretag' or request.page_type contains 'foretag'
    assign is_foretag_page = true
  endif

  # Choose which menu to use based on page type
  assign current_menu = section.settings.menu
  if is_foretag_page and section.settings.foretag_menu != blank
    assign current_menu = section.settings.foretag_menu
  endif
%}

<header
  id="{{ section_id }}"
  class="header-section fixed z-[100] w-full transition-all duration-300{% if inverted_mode %} inverted{% endif %}{% if is_foretag_page %} foretag-page{% endif %}"
  data-header
>
  <!-- Top bar -->
  <div class="header-topbar w-full px-[50px] py-[15px]{% if is_foretag_page %} bg-[#171717]{% else %} bg-[#F3F1E8]{% endif %}">
    <div class="text flex flex-row gap-[15px] px-[50px]">
      {% if is_foretag_page %}
        <a
          href="{{ routes.root_url }}"
          class="text-[12px] font-[300] text-white transition-opacity hover:opacity-70"
        >
          Privatperson
        </a>
        <a
          href="/pages/foretag/start"
          class="text-[18px] font-[400] text-white transition-opacity hover:opacity-70"
        >
          Företag
        </a>
      {% else %}
        <a
          href="{{ routes.root_url }}"
          class="text-[18px] font-[400] text-[#171717] transition-opacity hover:opacity-70"
        >
          Privatperson
        </a>
        <a
          href="/pages/foretag/start"
          class="text-[12px] font-[300] text-[#171717] transition-opacity hover:opacity-70"
        >
          Företag
        </a>
      {% endif %}
    </div>
  </div>

  <!-- Main header -->
  <div class="header-main{% if is_foretag_page %} w-full py-[15px]{% else %} header-gradient w-full py-[15px]{% endif %}">
    <div class="layout flex w-full flex-row items-center justify-between">
      <!-- Logo -->
      <a href="{{ routes.root_url }}" class="header-logo">
        <img
          src="{{ 'logga-vit.svg' | asset_url }}"
          alt="{{ shop.name }}"
          width="auto"
          height="53"
          class="logo-white h-auto  w-[175px] transition-opacity duration-300 md:h-[53px] md:w-auto"
        >
        <img
          src="{{ 'logga.svg' | asset_url }}"
          alt="{{ shop.name }}"
          width="auto"
          height="53"
          class="logo-dark absolute  left-0 top-0 h-auto w-[175px] opacity-0 transition-opacity duration-300 md:h-[53px] md:w-auto"
        >
      </a>

      <!-- Navigation -->
      <nav class="header-nav flex flex-row gap-[50px] text-white">
        {% for link in current_menu.links %}
          {% liquid
            assign has_dropdown = false

            if link.links.size > 0
              assign has_dropdown = true
            endif
          %}

          {% if has_dropdown %}
            <div class="nav-item  dropdown-item relative">
              <a
                href="{{ link.url }}"
                class="nav-link header-text flex items-center gap-[8px] transition-opacity hover:opacity-80"
              >
                {{ link.title }}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="9"
                  viewBox="0 0 14 9"
                  fill="none"
                  class="dropdown-arrow"
                >
                  <path d="M0.344765 0.837496C0.235521 0.943564 0.148811 1.06976 0.0896384 1.20879C0.0304655 1.34783 0 1.49696 0 1.64758C0 1.7982 0.0304655 1.94733 0.0896384 2.08637C0.148811 2.22541 0.235521 2.3516 0.344765 2.45767L6.17247 8.1625C6.28082 8.26944 6.40973 8.35433 6.55176 8.41225C6.69379 8.47018 6.84614 8.5 7 8.5C7.15387 8.5 7.30621 8.47018 7.44824 8.41225C7.59027 8.35433 7.71918 8.26944 7.82753 8.1625L13.6552 2.45767C13.7645 2.3516 13.8512 2.22541 13.9104 2.08637C13.9695 1.94733 14 1.7982 14 1.64758C14 1.49696 13.9695 1.34783 13.9104 1.20879C13.8512 1.06976 13.7645 0.943564 13.6552 0.837496C13.5469 0.730556 13.418 0.645674 13.2759 0.587749C13.1339 0.529823 12.9816 0.5 12.8277 0.5C12.6738 0.5 12.5215 0.529823 12.3795 0.587749C12.2374 0.645674 12.1085 0.730556 12.0002 0.837496L7 5.74365L1.99983 0.837496C1.89148 0.730556 1.76257 0.645674 1.62054 0.587749C1.47851 0.529823 1.32616 0.5 1.1723 0.5C1.01843 0.5 0.866091 0.529823 0.724059 0.587749C0.582027 0.645674 0.453117 0.730556 0.344765 0.837496Z" fill="currentColor"/>
                </svg>
              </a>

              <!-- Custom Dropdown -->
              <div class="mega-dropdown pointer-events-none invisible fixed left-0 right-0 top-[100px] z-50 w-screen pt-[35px] opacity-0 transition-all duration-300">
                <div class="layout pointer-events-auto mx-auto">
                  <div class="shadow-bg grid w-full grid-cols-2 gap-[30px] rounded-[15px] bg-white px-[50px] py-[40px]">
                    <!-- Left Column - Categories only -->
                    <div class="flex flex-col">
                      <div class="headline1 pb-[40px] text-[50px] text-[#171717]">
                        {{ link.title }}
                      </div>
                      <div class="flex flex-col gap-[10px]">
                        {% for child_link in link.links %}
                          <a
                            href="{{ child_link.url }}"
                            class="dropdown-category headline1 flex w-full flex-row justify-between rounded-[15px] p-[18px] text-[24px] text-[#171717] transition-colors {% if forloop.first %}bg-[#F3F1E8]{% else %}bg-white{% endif %} hover:bg-[#F3F1E8]"
                            data-category-index="{{ forloop.index0 }}"
                          >
                            {{ child_link.title }}
                            <div>
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="23"
                                height="18"
                                viewBox="0 0 23 18"
                                fill="none"
                              >
                                <path d="M1.55554 9H22L14 1" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M1.55554 8.99994H22L14 16.9999" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          </a>
                        {% endfor %}
                      </div>
                    </div>

                    <!-- Right Column - Products Grid -->
                    <div class="flex h-full flex-col gap-[20px]">
                      {% for child_link in link.links %}
                        <div
                          class="category-products {% if forloop.first %}active{% endif %}"
                          data-products-index="{{ forloop.index0 }}"
                          style="{% unless forloop.first %}display: none;{% endunless %}"
                        >
                          {% if child_link.links.size > 0 %}
                            <div class="grid grid-cols-3 gap-[15px]">
                              {% for nested_link in child_link.links %}
                                <a
                                  href="{{ nested_link.url }}"
                                  class="group flex flex-col items-center gap-[10px] rounded-[15px] bg-[#F6F6F6] p-[20px] transition-opacity hover:opacity-80"
                                >
                                  {% if nested_link.type == 'product_link'
                                    and nested_link.object.featured_image
                                  %}
                                    <div class="h-[100px] w-[100px] flex-shrink-0 overflow-hidden rounded-[10px]">
                                      <img
                                        src="{{ nested_link.object.featured_image | image_url: width: 200 }}"
                                        alt="{{ nested_link.object.featured_image.alt | default: nested_link.title }}"
                                        width="100"
                                        height="100"
                                        class="h-full w-full object-contain"
                                        loading="lazy"
                                      >
                                    </div>
                                  {% endif %}
                                  <span class="body1 text-center text-[16px] text-[#171717]">
                                    {{ nested_link.title }}
                                  </span>
                                </a>
                              {% endfor %}
                            </div>
                          {% else %}
                            <!-- Show featured content when no products -->
                            <div class="flex h-full flex-col gap-[20px]">
                              {% if section.settings.dropdown_image != blank %}
                                <div class="overflow-hidden rounded-[15px]">
                                  {% if section.settings.dropdown_link != blank %}
                                    <a
                                      href="{{ section.settings.dropdown_link }}"
                                      class="group block"
                                    >
                                      <img
                                        src="{{ section.settings.dropdown_image | image_url: width: 600 }}"
                                        alt="{{ section.settings.dropdown_image.alt | default: section.settings.dropdown_heading }}"
                                        width="600"
                                        height="auto"
                                        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                                        loading="lazy"
                                      >
                                    </a>
                                  {% else %}
                                    <img
                                      src="{{ section.settings.dropdown_image | image_url: width: 600 }}"
                                      alt="{{ section.settings.dropdown_image.alt | default: section.settings.dropdown_heading }}"
                                      width="600"
                                      height="auto"
                                      class="h-full w-full object-cover"
                                      loading="lazy"
                                    >
                                  {% endif %}
                                </div>
                              {% endif %}

                              {% if section.settings.dropdown_heading != blank
                                or section.settings.dropdown_text != blank
                              %}
                                <div class="flex flex-col gap-[10px] px-[20px]">
                                  {% if section.settings.dropdown_heading != blank %}
                                    <h3 class="headline1 text-[32px] text-[#171717]">
                                      {{ section.settings.dropdown_heading }}
                                    </h3>
                                  {% endif %}

                                  {% if section.settings.dropdown_text != blank %}
                                    <p class="body1 text-[16px] text-[#171717]/80">
                                      {{ section.settings.dropdown_text }}
                                    </p>
                                  {% endif %}

                                  {% if section.settings.dropdown_button_text != blank
                                    and section.settings.dropdown_link != blank
                                  %}
                                    <a
                                      href="{{ section.settings.dropdown_link }}"
                                      class="knappetikett mt-[10px] inline-flex w-fit flex-row items-center gap-[10px] rounded-full bg-[#E9A600] px-[25px] py-[12px] text-[#171717] transition-opacity hover:opacity-80"
                                      style="text-decoration: none;"
                                    >
                                      {{ section.settings.dropdown_button_text }}
                                      <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="18"
                                        height="14"
                                        viewBox="0 0 22 18"
                                        fill="none"
                                      >
                                        <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      </svg>
                                    </a>
                                  {% endif %}
                                </div>
                              {% endif %}
                            </div>
                          {% endif %}
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <a
              href="{{ link.url }}"
              class="nav-link header-text transition-opacity hover:opacity-80"
            >
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}
      </nav>

      <!-- Cart / Företag CTA button -->
      <div class="flex items-center gap-[15px]">
        {% if is_foretag_page %}
          <!-- Desktop: Show "Be om offert" button -->
          <a
            href="{{ section.settings.foretag_quote_link | default: '/pages/foretag/offert' }}"
            class="cart-btn knappetikett relative hidden flex-row gap-[20px] rounded-full bg-white p-[20px] py-[15px] text-[#171717] transition-colors hover:bg-gray-100 md:flex"
            style="text-decoration: none;"
          >
            <span class="flex flex-row items-center  justify-center gap-[10px] xl:flex">
              <div>Be om offert</div>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="18"
                viewBox="0 0 22 18"
                fill="none"
              >
                <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </a>
          <!-- Mobile: Show hamburger menu -->
          <button
            class="knappetikett mobile-menu-toggle relative flex h-[50px] w-[50px] items-center justify-center rounded-full bg-white md:hidden"
            data-mobile-menu-toggle
            aria-label="Toggle menu"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="16"
              viewBox="0 0 22 16"
              fill="none"
            >
              <path d="M1 15H21" stroke="#171717" stroke-width="2" stroke-linecap="round"/>
              <path d="M1 1H21" stroke="#171717" stroke-width="2" stroke-linecap="round"/>
              <path d="M1 8H21" stroke="#171717" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        {% else %}
          <button
            class="cart-btn knappetikett relative hidden flex-row  gap-[20px] rounded-full bg-white p-[20px] py-[15px] text-[#171717] transition-colors hover:bg-gray-100 md:flex"
            data-cart-toggle
          >
            <span class="hidden xl:block ">kundvagn</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="21"
              height="22"
              viewBox="0 0 21 22"
              fill="none"
            >
              <path d="M2.37325 16.02L1.16926 8.84C0.98726 7.754 0.896261 7.212 1.18826 6.856C1.47926 6.5 2.01525 6.5 3.08624 6.5H17.9141C18.9851 6.5 19.5211 6.5 19.8121 6.856C20.1041 7.212 20.0121 7.754 19.8311 8.84L18.6271 16.02C18.2281 18.4 18.0291 19.589 17.2141 20.295C16.4001 21 15.2261 21 12.8782 21H8.12219C5.77422 21 4.60023 21 3.78623 20.294C2.97124 19.589 2.77224 18.399 2.37325 16.019M16.0001 6.5C16.0001 5.04131 15.4207 3.64236 14.3892 2.61091C13.3578 1.57946 11.9588 1 10.5002 1C9.0415 1 7.64256 1.57946 6.61112 2.61091C5.57968 3.64236 5.00022 5.04131 5.00022 6.5" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <!-- Cart count badge -->
            <span
              class="cart-count absolute -right-2 -top-2 flex h-6 w-6 scale-0 items-center justify-center rounded-full bg-[#171717] text-xs font-bold text-white opacity-0 transition-all duration-200"
              data-cart-count
            >
              0
            </span>
          </button>
          <button
            class="knappetikett mobile-menu-toggle relative flex h-[50px] w-[50px] items-center justify-center rounded-full bg-white md:hidden"
            data-mobile-menu-toggle
            aria-label="Toggle menu"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="16"
              viewBox="0 0 22 16"
              fill="none"
            >
              <path d="M1 15H21" stroke="#171717" stroke-width="2" stroke-linecap="round"/>
              <path d="M1 1H21" stroke="#171717" stroke-width="2" stroke-linecap="round"/>
              <path d="M1 8H21" stroke="#171717" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Mobile Dropdown Menu -->
  <div
    class="mobile-dropdown layout"
    data-mobile-dropdown
  >
    <div class="mt-[10px] max-h-[calc(100vh-120px)] overflow-y-auto rounded-[10px] bg-white p-[30px] shadow-lg">
      <nav class="flex flex-col gap-[0px] bg-white">
        {% for link in current_menu.links %}
          {% liquid
            assign has_dropdown = false
            if link.links.size > 0
              assign has_dropdown = true
            endif
          %}

          {% if has_dropdown %}
            <!-- Menu item with submenu -->
            <div class="mobile-nav-item border-b border-[#E5E5E5]">
              <button
                class="
                  mobile-nav-button headline1 flex w-full items-center justify-between bg-white
                  py-[16px] text-left text-[30px] text-[#171717]
                "
                data-mobile-submenu-toggle
              >
                <span>{{ link.title }}</span>
                <svg
                  class="mobile-submenu-arrow transition-transform duration-300"
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="9"
                  viewBox="0 0 14 9"
                  fill="none"
                >
                  <path d="M0.344765 0.837496C0.235521 0.943564 0.148811 1.06976 0.0896384 1.20879C0.0304655 1.34783 0 1.49696 0 1.64758C0 1.7982 0.0304655 1.94733 0.0896384 2.08637C0.148811 2.22541 0.235521 2.3516 0.344765 2.45767L6.17247 8.1625C6.28082 8.26944 6.40973 8.35433 6.55176 8.41225C6.69379 8.47018 6.84614 8.5 7 8.5C7.15387 8.5 7.30621 8.47018 7.44824 8.41225C7.59027 8.35433 7.71918 8.26944 7.82753 8.1625L13.6552 2.45767C13.7645 2.3516 13.8512 2.22541 13.9104 2.08637C13.9695 1.94733 14 1.7982 14 1.64758C14 1.49696 13.9695 1.34783 13.9104 1.20879C13.8512 1.06976 13.7645 0.943564 13.6552 0.837496C13.5469 0.730556 13.418 0.645674 13.2759 0.587749C13.1339 0.529823 12.9816 0.5 12.8277 0.5C12.6738 0.5 12.5215 0.529823 12.3795 0.587749C12.2374 0.645674 12.1085 0.730556 12.0002 0.837496L7 5.74365L1.99983 0.837496C1.89148 0.730556 1.76257 0.645674 1.62054 0.587749C1.47851 0.529823 1.32616 0.5 1.1723 0.5C1.01843 0.5 0.866091 0.529823 0.724059 0.587749C0.582027 0.645674 0.453117 0.730556 0.344765 0.837496Z" fill="currentColor"/>
                </svg>
              </button>

              <!-- Submenu -->
              <div class="mobile-submenu max-h-0 overflow-hidden transition-all duration-300">
                <div class="flex flex-col gap-[4px] pb-[12px] pl-[15px] pt-[8px]">
                  {% for child_link in link.links %}
                    <div class="flex flex-col gap-[6px] border-b border-[#F3F1E8] pb-[10px] last:border-b-0">
                      <!-- Category link -->
                      <a
                        href="{{ child_link.url }}"
                        class="body1 py-[10px] text-[18px] text-[#171717] transition-opacity hover:opacity-70"
                      >
                        {{ child_link.title }}
                      </a>

                      <!-- Nested products under category -->
                      {% if child_link.links.size > 0 %}
                        <div class="ml-[15px] flex flex-col">
                          {% for nested_link in child_link.links %}
                            <a
                              href="{{ nested_link.url }}"
                              class="group flex flex-row items-center gap-[10px] border-b border-[#F6F6F6] py-[8px] transition-opacity last:border-b-0 hover:opacity-70"
                            >
                              {% if nested_link.type == 'product_link'
                                and nested_link.object.featured_image
                              %}
                                <div class="h-[40px] w-[40px] flex-shrink-0 overflow-hidden rounded-[6px]">
                                  <img
                                    src="{{ nested_link.object.featured_image | image_url: width: 80 }}"
                                    alt="{{ nested_link.object.featured_image.alt | default: nested_link.title }}"
                                    width="40"
                                    height="40"
                                    class="h-full w-full object-contain"
                                    loading="lazy"
                                  >
                                </div>
                              {% endif %}
                              <span class="body1 flex-1 text-[14px] text-[#171717]/80">
                                {{ nested_link.title }}
                              </span>
                            </a>
                          {% endfor %}
                        </div>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% else %}
            <!-- Simple menu item -->
            <a
              href="{{ link.url }}"
              class="headline1 border-b border-[#E5E5E5] py-[16px] text-[30px] text-[#171717]"
            >
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}
      </nav>

      <!-- Mobile Menu Footer -->

      <!-- Mobile Cart Button / Quote Button -->
      <div class="mt-[20px]">
        {% if is_foretag_page %}
          <a
            href="{{ section.settings.foretag_quote_link | default: '/pages/foretag/offert' }}"
            class="knappetikett flex w-full flex-row items-center justify-center gap-[20px] rounded-full p-[20px] py-[15px] text-[#171717] transition-colors hover:bg-gray-100"
            style="background: #E9A600; text-decoration: none;"
          >
            <span>Be om offert</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="18"
              viewBox="0 0 22 18"
              fill="none"
            >
              <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        {% else %}
          <button
            class="knappetikett relative flex w-full flex-row items-center justify-center gap-[20px] rounded-full bg-white p-[20px] py-[15px] text-[#171717] transition-colors hover:bg-gray-100"
            style="border: 1px solid #171717;"
            data-cart-toggle
          >
            <span>Kundvagn</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="21"
              height="22"
              viewBox="0 0 21 22"
              fill="none"
            >
              <path d="M2.37325 16.02L1.16926 8.84C0.98726 7.754 0.896261 7.212 1.18826 6.856C1.47926 6.5 2.01525 6.5 3.08624 6.5H17.9141C18.9851 6.5 19.5211 6.5 19.8121 6.856C20.1041 7.212 20.0121 7.754 19.8311 8.84L18.6271 16.02C18.2281 18.4 18.0291 19.589 17.2141 20.295C16.4001 21 15.2261 21 12.8782 21H8.12219C5.77422 21 4.60023 21 3.78623 20.294C2.97124 19.589 2.77224 18.399 2.37325 16.019M16.0001 6.5C16.0001 5.04131 15.4207 3.64236 14.3892 2.61091C13.3578 1.57946 11.9588 1 10.5002 1C9.0415 1 7.64256 1.57946 6.61112 2.61091C5.57968 3.64236 5.00022 5.04131 5.00022 6.5" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <!-- Cart count badge -->
            <span
              class="cart-count absolute -right-2 -top-2 flex h-6 w-6 scale-0 items-center justify-center rounded-full bg-[#171717] text-xs font-bold text-white opacity-0 transition-all duration-200"
              data-cart-count
            >
              0
            </span>
          </button>
        {% endif %}
      </div>
    </div>
  </div>
</header>

<!-- Include Cart Drawer -->
{% render 'cart-drawer' %}

<!-- Load Cart JavaScript -->
<script src="{{ 'cart.js' | asset_url }}" defer></script>

<!-- Load Dropdown JavaScript -->
<script src="{{ 'dropdown.js' | asset_url }}" defer></script>

<!-- Load Header Scroll JavaScript -->
<script src="{{ 'header-scroll.js' | asset_url }}" defer></script>

<!-- Load Mobile Menu JavaScript -->
<script src="{{ 'mobile-menu.js' | asset_url }}" defer></script>

{% stylesheet %}
  .header-section {
    --header-text-color: white;
    --header-bg: linear-gradient(0deg, rgba(23, 23, 23, 0) 0%, #171717 100%);
    --logo-white-opacity: 1;
    --logo-dark-opacity: 0;
  }

  .header-section.scrolled {
    --header-text-color: #171717;
    --header-bg: white;
    --logo-white-opacity: 0;
    --logo-dark-opacity: 1;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  /* Ensure white background appears on scroll */
  .header-section.scrolled .header-gradient {
    background: white !important;
  }

  /* Scrolled state gets same cart button styling as inverted mode */
  .header-section.scrolled .cart-btn {
    background: #e9a600;
    color: #171717;
  }

  .header-section.scrolled .cart-btn svg path {
    stroke: #171717;
  }

  .header-section.scrolled .cart-btn:hover {
    background: #e9a600;
  }

  /* Inverted mode - dark text, no gradient */
  .header-section.inverted {
    --header-text-color: #171717;
    --header-bg: white;
    --logo-white-opacity: 0;
    --logo-dark-opacity: 1;
  }

  /* When inverted mode is active, scrolled state keeps the same styling */
  .header-section.inverted.scrolled {
    --header-text-color: #171717;
    --header-bg: white;
    --logo-white-opacity: 0;
    --logo-dark-opacity: 1;
  }

  /* Företag pages - transparent by default, white background on scroll */
  .header-section.foretag-page .header-main {
    background: transparent;
  }

  .header-section.foretag-page.scrolled {
    --header-text-color: #171717;
    --header-bg: white;
    --logo-white-opacity: 0;
    --logo-dark-opacity: 1;
  }

  .header-section.foretag-page.scrolled .header-main {
    background: white !important;
  }

  .header-gradient {
    background: var(--header-bg);
  }

  .header-nav {
    color: var(--header-text-color);
  }

  .header-text {
    color: var(--header-text-color) !important;
  }

  .dropdown-arrow {
    color: var(--header-text-color);
  }

  .logo-white {
    opacity: var(--logo-white-opacity);
  }

  .logo-dark {
    opacity: var(--logo-dark-opacity);
  }

  .header-logo {
    position: relative;
  }

  .cart-count.show {
    opacity: 1;
    scale: 1;
  }

  /* Cart button styling for inverted mode */
  .header-section.inverted .cart-btn {
    background: #e9a600;
    color: #171717;
  }

  .header-section.inverted .cart-btn svg path {
    stroke: #171717;
  }

  .header-section.inverted .cart-btn:hover {
    background: #e9a600;
  }

  /* Mega Dropdown Styles */
  .dropdown-item:hover .mega-dropdown {
    opacity: 1;
    visibility: visible;
  }

  /* Adjust dropdown padding when header is scrolled */
  .header-section.scrolled .mega-dropdown {
    padding-top: 50px;
  }

  .dropdown-image {
    transition: transform 0.3s ease;
  }

  /* Product card styling */
  .dropdown-product-card {
    text-decoration: none;
  }

  .dropdown-product-card:hover {
    transform: translateY(-2px);
  }

  /* Ensure dropdown category backgrounds work properly */
  .dropdown-category[class*='bg-[#F3F1E8]'] {
    background-color: #f3f1e8 !important;
  }

  .dropdown-category[class*='bg-white'] {
    background-color: white !important;
  }

  /* Product switching transition */
  .category-products {
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
  }

  .category-products.active {
    opacity: 1;
  }

  /* Mobile Dropdown Menu Styles */
  .mobile-dropdown {
    opacity: 0;
    visibility: hidden;
    max-height: 0;
    overflow: hidden;
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease,
      max-height 0.3s ease;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .mobile-dropdown.active {
    opacity: 1;
    visibility: visible;
    overflow: visible;
  }

  /* Smooth scrolling for mobile menu */
  .mobile-dropdown > div {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }

  /* Custom scrollbar for mobile menu */
  .mobile-dropdown > div::-webkit-scrollbar {
    width: 6px;
  }

  .mobile-dropdown > div::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  .mobile-dropdown > div::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
  }

  .mobile-dropdown > div::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  /* Mobile submenu active state */
  .mobile-nav-item.active .mobile-submenu {
    max-height: 2000px;
  }

  .mobile-nav-item.active .mobile-submenu-arrow {
    transform: rotate(180deg);
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .header-topbar {
      padding-left: 20px;
      padding-right: 20px;
    }

    .header-topbar .flex {
      padding-left: 20px;
      padding-right: 20px;
    }

    .header-nav {
      gap: 25px;
      font-size: 14px;
    }

    .layout {
      padding-left: 20px;
      padding-right: 20px;
    }
  }
  @media (min-width: 768px) {
    .mobile-dropdown {
      display: none !important;
    }
  }

  @media (max-width: 1023px) {
    .header-nav {
      display: none;
    }
  }
  @media (max-width: 640px) {
    .header-nav {
      display: none;
    }

    .cart-btn {
      padding: 15px;
      gap: 15px;
    }

    .mega-dropdown {
      display: none;
    }
  }
{% endstylesheet %}

{% comment %}
  Header scroll functionality is handled in header-scroll.js
  Dropdown interactions are handled in dropdown.js
  Mobile dropdown menu functionality is handled in mobile-menu.js
{% endcomment %}

{% schema %}
{
  "name": "Sidhuvud",
  "tag": "header",
  "class": "header-section",
  "settings": [
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Huvudmeny",
      "info": "Välj vilken meny som ska visas i sidhuvudet"
    },
    {
      "type": "link_list",
      "id": "foretag_menu",
      "label": "Företagsmeny",
      "info": "Välj vilken meny som ska visas på företagssidor (om inget väljs används huvudmenyn)"
    },
    {
      "type": "header",
      "content": "Inverterat läge inställningar"
    },
    {
      "type": "paragraph",
      "content": "Inverterat läge visar mörk text och vit bakgrund istället för vit text och gradient bakgrund. Produkt- och kollektionssidor använder inverterat läge som standard."
    },
    {
      "type": "checkbox",
      "id": "inverted_mode_global",
      "label": "Aktivera globalt inverterat läge",
      "info": "Detta kommer att aktivera inverterat läge på alla sidor",
      "default": false
    },
    {
      "type": "textarea",
      "id": "inverted_pages",
      "label": "Specifika sidor för inverterat läge",
      "info": "Ange sidhandtag eller mallnamn separerade med komma (t.ex: om-oss, kontakt, product, collection). Detta åsidosätter den globala inställningen.",
      "placeholder": "om-oss, kontakt, support"
    },
    {
      "type": "textarea",
      "id": "inverted_url_fragments",
      "label": "Specifika URL-delar för inverterat läge",
      "info": "Ange delar av URL att matcha (komma-separerat), t.ex. /pages/foretag/offert",
      "placeholder": "/pages/foretag/offert, /pages/offert-forfragan"
    },
    {
      "type": "url",
      "id": "foretag_quote_link",
      "label": "Företag: länk för 'Be om offert'",
      "info": "Visas på företagssidor istället för varukorgsknappen"
    },
    {
      "type": "header",
      "content": "Produkter i dropdown"
    },
    {
      "type": "paragraph",
      "content": "Produkter visas automatiskt i dropdowns om du lägger till produktlänkar i din navigation. Lägg till produkter direkt i din meny i Shopify Admin under 'Online Store > Navigation'. Om en meny har produktlänkar som undermenyer kommer produkterna att visas i högerkolumnen av dropdown-menyn."
    },
    {
      "type": "header",
      "content": "Dropdown högerkolumn - Innehåll"
    },
    {
      "type": "paragraph",
      "content": "Anpassa innehållet som visas i högerkolumnen av dropdown-menyn"
    },
    {
      "type": "image_picker",
      "id": "dropdown_image",
      "label": "Dropdown bild",
      "info": "Visas i högerkolumnen av dropdown-menyn"
    },
    {
      "type": "text",
      "id": "dropdown_heading",
      "label": "Dropdown rubrik",
      "placeholder": "t.ex. Nyhet!"
    },
    {
      "type": "textarea",
      "id": "dropdown_text",
      "label": "Dropdown text",
      "placeholder": "Beskrivande text om kampanjen eller erbjudandet"
    },
    {
      "type": "text",
      "id": "dropdown_button_text",
      "label": "Knapptext",
      "placeholder": "t.ex. Läs mer"
    },
    {
      "type": "url",
      "id": "dropdown_link",
      "label": "Dropdown länk",
      "info": "Länken som bilden och knappen leder till"
    }
  ]
}
{% endschema %}
