{% liquid
  assign section_id = section.settings.custom_id | default: section.id
  assign section_class = 'banner-med-2-produkter'
  assign layout_reversed = false
  if section.settings.layout_direction == 'products_first'
    assign layout_reversed = true
  endif
%}

<section
  id="{{ section_id }}"
  class="{{ section_class }} layout py-[60px] md:py-[85px]"
>
  {% comment %} Banner Content {% endcomment %}
  <div
    class="banner-content relative h-[500px] w-full overflow-hidden rounded-[10px] bg-cover bg-center bg-no-repeat p-[20px] md:px-[50px] md:py-[40px] {% if layout_reversed %}order-2{% else %}order-1{% endif %}"
    style="background-color: {{ section.settings.background_color }}; {% if section.settings.background_image %}background-image: url({{ section.settings.background_image | image_url: width: 1200 }});{% endif %}"
    data-debug="layout_reversed: {{ layout_reversed }}, setting: {{ section.settings.layout_direction }}"
  >
    {% if section.settings.overlay_opacity > 0 %}
      <div
        class="absolute inset-0 rounded-[10px]"
        style="background-color: rgba(0, 0, 0, {{ section.settings.overlay_opacity | divided_by: 100.0 }});"
      ></div>
    {% endif %}
    <div class="relative z-10 flex h-full flex-col justify-between">
      <div>
        {% if section.settings.header_button_text != blank %}
          <a
            href="{{ section.settings.header_button_url }}"
            class="knappetikett2 z-10 inline-block rounded-full bg-transparent p-[15px] text-white"
            style="border: 1px solid #fff;"
          >
            {{ section.settings.header_button_text }}
          </a>
        {% endif %}
      </div>
      <div class="flex flex-col gap-[30px] lg:w-[840px]">
        {% if section.settings.heading != blank %}
          <h2 class="headline2 text-white ">
            {{ section.settings.heading }}
          </h2>
        {% endif %}
        {% if section.settings.description != blank %}
          <p class="knappetikett text-white">
            {{ section.settings.description }}
          </p>
        {% endif %}
        <div class="flex flex-row gap-[10px]">
          {% if section.settings.primary_button_text != blank %}
            <a
              href="{{ section.settings.primary_button_url }}"
              class="knappetikett flex shrink-0 flex-row items-center gap-[20px] rounded-full px-[20px] py-[17px] text-[#171717]"
              style="background: linear-gradient(135deg, #FFA94D 0%, #FF4E33 100%);"
            >
              {{ section.settings.primary_button_text }}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="18"
                viewBox="0 0 22 18"
                fill="none"
              >
                <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          {% endif %}
          {% if section.settings.secondary_button_text != blank %}
            <a
              href="{{ section.settings.secondary_button_url }}"
              class="knappetikett flex shrink-0 flex-row items-center gap-[20px] rounded-full bg-transparent px-[20px] py-[17px] text-white"
              style="border: 1px solid #fff;"
            >
              {{ section.settings.secondary_button_text }}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="18"
                viewBox="0 0 22 18"
                fill="none"
              >
                <path d="M1 8.99991H21L13.1739 1.17383" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1 8.9996H21L13.1739 16.8257" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% comment %} Products Content {% endcomment %}
  <div
    class="products-content w-full {% if layout_reversed %}order-1{% else %}order-2{% endif %}"
    data-debug="products order: {% if layout_reversed %}1{% else %}2{% endif %}"
  >
    <!-- Mobile carousel container -->
    <div class="relative w-full md:hidden">
      <div class="carousel-container w-full overflow-hidden">
        <div
          class="carousel-track flex transition-transform duration-500 ease-in-out"
          data-current="0"
        >
          {% for block in section.blocks %}
            {% liquid
              assign product = block.settings.product
              assign product_title = product.title
              assign product_description = product.description | strip_html | truncatewords: 15
              if block.settings.custom_url != blank
                assign product_url = block.settings.custom_url
              else
                assign product_url = product.url
              endif
            %}
            <div
              class="product-card flex w-full flex-shrink-0 flex-col-reverse rounded-[10px] p-[30px]"
              style="background: #F3F1E8;"
              {{ block.shopify_attributes }}
            >
              <div class="flex flex-col justify-between ">
                <div class="flex flex-col">
                  {% if product_title != blank %}
                    <div class="headline1 pt-[30px] text-[36px] text-[#171717]">
                      {{ product_title }}
                    </div>
                  {% endif %}
                  {% if product_description != blank %}
                    <div class="text py-[20px] text-[#171717]/75">
                      {{ product_description }}
                    </div>
                  {% endif %}
                </div>
                <div class="flex shrink-0 gap-[10px]">
                  {% if product_url != blank %}
                    <a
                      href="{{ product_url }}"
                      class="knappetikett flex flex-row items-center gap-[10px] rounded-full px-[20px] py-[18px] text-[#171717]"
                      style="background: linear-gradient(135deg, #FFA94D 0%, #FF4E33 100%);"
                    >
                      Köp nu
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="22"
                        height="18"
                        viewBox="0 0 22 18"
                        fill="none"
                      >
                        <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </a>
                  {% endif %}
                </div>
              </div>
              <div class="flex w-full items-center justify-center">
                {% if block.settings.product != blank %}
                  {% assign product = block.settings.product %}
                  {% if product.featured_image %}
                    <img
                      src="{{ product.featured_image | image_url: width: 300 }}"
                      alt="{{ product.featured_image.alt | default: product.title }}"
                      width="200"
                      height="200"
                      class="h-auto w-full max-w-[200px] rounded-[5px] object-contain"
                      loading="lazy"
                    >
                  {% else %}
                    <div class="flex h-[200px] w-[200px] items-center justify-center rounded-[5px] bg-gray-200 text-gray-500">
                      {{ 'products.product.media.load_image' | t | default: 'Load image' }}
                    </div>
                  {% endif %}
                {% else %}
                  <div class="flex h-full w-[200px] items-center justify-center rounded-[5px] bg-gray-200 text-gray-500">
                    {{
                      'sections.banner_with_products.no_product_selected'
                      | t
                      | default: 'No product selected'
                    }}
                  </div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
    <!-- Desktop grid -->
    <div
      class=" hidden grid-cols-2 gap-[20px] md:grid"
      id="desktop-products-grid-{{ section.id }}"
    >
      {% for block in section.blocks %}
        {% liquid
          assign product = block.settings.product
          assign product_title = product.title
          assign product_description = product.description | strip_html | truncatewords: 15
          if block.settings.custom_url != blank
            assign product_url = block.settings.custom_url
          else
            assign product_url = product.url
          endif
        %}
        <div
          class="product-card flex flex-col-reverse rounded-[10px] p-[30px] transition-colors xl:flex-row duration-300{% if forloop.first %} active{% endif %}"
          {{ block.shopify_attributes }}
          data-card-index="{{ forloop.index0 }}"
        >
          <div class="flex flex-col justify-between ">
            <div class="flex flex-col">
              {% if product_title != blank %}
                <div class="headline1 pt-[40px] text-[36px] text-[#171717] xl:pt-0">
                  {{ product_title }}
                </div>
              {% endif %}
              {% if product_description != blank %}
                <div class="text py-[20px] text-[#171717]/75 xl:pt-[40px]">
                  {{ product_description }}
                </div>
              {% endif %}
            </div>
            <div class="flex shrink-0 gap-[10px]">
              {% if product_url != blank %}
                <a
                  href="{{ product_url }}"
                  class="knappetikett flex shrink-0 flex-row items-center gap-[10px] whitespace-nowrap rounded-full px-[20px] py-[18px] text-[#171717]"
                  style="background: linear-gradient(135deg, #FFA94D 0%, #FF4E33 100%);"
                >
                  Köp nu
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="22"
                    height="18"
                    viewBox="0 0 22 18"
                    fill="none"
                  >
                    <path d="M1 8.99991H21L13.1739 1.17383" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1 9.00009H21L13.1739 16.8262" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              {% endif %}
            </div>
          </div>
          <div class="flex w-full items-center justify-center">
            {% if block.settings.product != blank %}
              {% assign product = block.settings.product %}
              {% if product.featured_image %}
                <img
                  src="{{ product.featured_image | image_url: width: 3000 }}"
                  alt="{{ product.featured_image.alt | default: product.title }}"
                  width="200"
                  height="200"
                  class=" h-full w-full rounded-[5px] object-contain"
                  loading="lazy"
                >
              {% else %}
                <div class="flex h-[200px] w-[200px] items-center justify-center rounded-[5px] bg-gray-200 text-gray-500">
                  {{ 'products.product.media.load_image' | t | default: 'Load image' }}
                </div>
              {% endif %}
            {% else %}
              <div class="flex h-full w-[200px] items-center justify-center rounded-[5px] bg-gray-200 text-gray-500">
                {{
                  'sections.banner_with_products.no_product_selected'
                  | t
                  | default: 'No product selected'
                }}
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Carousel navigation (only show on mobile) -->
    <div class="flex flex-row gap-[20px] pl-[20px] pt-[20px] md:hidden">
      <div class="carousel-prev translate-x-[-1] cursor-pointer">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="26"
          height="21"
          viewBox="0 0 26 21"
          fill="none"
        >
          <path d="M25 10.3915H1M1 10.3915L10.3913 1M1 10.3915L10.3913 19.7826" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="carousel-next cursor-pointer">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="26"
          height="21"
          viewBox="0 0 26 21"
          fill="none"
        >
          <path d="M1 10.3915H25M25 10.3915L15.6087 1M25 10.3915L15.6087 19.7826" stroke="#171717" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>
  </div>
</section>

{% stylesheet %}
  .banner-med-2-produkter {
    display: flex !important;
    flex-direction: column !important;
    gap: 20px;
    max-width: 100%;
    overflow: hidden;
  }

  .banner-med-2-produkter .products-content {
    max-width: 100%;
    overflow: hidden;
  }

  .banner-content.order-1 {
    order: 1 !important;
  }

  .banner-content.order-2 {
    order: 2 !important;
  }

  .products-content.order-1 {
    order: 1 !important;
  }

  .products-content.order-2 {
    order: 2 !important;
  }

  .banner-med-2-produkter a {
    text-decoration: none;
  }

  .banner-med-2-produkter a:hover {
    text-decoration: none;
  }

  .product-card .banner-2-learn-more-btn {
    background: linear-gradient(135deg, #ffa94d 0%, #ff4e33 100%);
    color: #171717;
    transition: all 0.3s ease;
  }

  .product-card.active .banner-2-learn-more-btn,
  .product-card:hover .banner-2-learn-more-btn {
    background: linear-gradient(135deg, #ffa94d 0%, #ff4e33 100%) !important;
    border: none !important;
    color: #171717 !important;
  }

  /* More specific override to ensure gradient is applied */
  .banner-med-2-produkter .product-card.active .banner-2-learn-more-btn,
  .banner-med-2-produkter .product-card:hover .banner-2-learn-more-btn {
    background: linear-gradient(135deg, #ffa94d 0%, #ff4e33 100%) !important;
    border: none !important;
    border-color: transparent !important;
  }

  .product-card.active .banner-2-learn-more-btn svg path,
  .product-card:hover .banner-2-learn-more-btn svg path {
    stroke: #171717 !important;
  }

  /* Card background transition */
  .product-card {
    transition: background-color 0.3s ease;
  }

  .product-card.active,
  .product-card:hover {
    background-color: #f3f1e8 !important;
  }

  .carousel-container {
    position: relative;
    width: 100%;
  }

  .carousel-track {
    transition: transform 0.5s ease-in-out;
    width: 100%;
  }

  .carousel-track .product-card {
    min-width: 100%;
    max-width: 100%;
    flex-basis: 100%;
  }

  .carousel-prev,
  .carousel-next {
    transition: all 0.2s ease-in-out;
    border: none;
    outline: none;
  }

  .carousel-prev:hover,
  .carousel-next:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .carousel-prev:active,
  .carousel-next:active {
    transform: scale(0.95);
  }

  .carousel-prev:disabled,
  .carousel-next:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .carousel-prev:disabled:hover,
  .carousel-next:disabled:hover {
    transform: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
{% endstylesheet %}

<script src="{{ 'banner-med-2-produkter.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Banner med 2 produkter",
  "tag": "section",
  "class": "banner-med-2-produkter",
  "max_blocks": 2,
  "blocks": [
    {
      "type": "product_card",
      "name": "Product Card",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product",
          "info": "Product title, description (limited to 15 words), and link will be automatically used"
        },
        {
          "type": "text",
          "id": "learn_more_text",
          "label": "Learn More Button Text (Desktop only)",
          "default": "Läs mer",
          "info": "This button only shows on desktop. Mobile shows 'Köp' button."
        },
        {
          "type": "url",
          "id": "custom_url",
          "label": "Custom Product URL (Optional)",
          "info": "Leave blank to use the product's default URL"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "layout_direction",
      "label": "Layout Direction",
      "options": [
        {
          "value": "banner_first",
          "label": "Banner First (Default)"
        },
        {
          "value": "products_first",
          "label": "Products First (Reversed)"
        }
      ],
      "default": "banner_first"
    },
    {
      "type": "header",
      "content": "Header Content"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f5f5f5"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "info": "Add a dark overlay over the background image for better readability",
      "min": 0,
      "max": 80,
      "step": 5,
      "unit": "%",
      "default": 0
    },
    {
      "type": "text",
      "id": "header_button_text",
      "label": "Header Button Text",
      "default": "Läs mer"
    },
    {
      "type": "url",
      "id": "header_button_url",
      "label": "Header Button URL"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Smarta elbilsladdare för alla behov"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Våra elbilsladdare är designade för att vara enkel att använda och installera, med hög effekt och snabb laddning."
    },
    {
      "type": "text",
      "id": "primary_button_text",
      "label": "Primary Button Text",
      "default": "Privat"
    },
    {
      "type": "url",
      "id": "primary_button_url",
      "label": "Primary Button URL"
    },
    {
      "type": "text",
      "id": "secondary_button_text",
      "label": "Secondary Button Text",
      "default": "Företag"
    },
    {
      "type": "url",
      "id": "secondary_button_url",
      "label": "Secondary Button URL"
    }
  ],
  "presets": [
    {
      "name": "Banner med 2 produkter",
      "blocks": [
        {
          "type": "product_card"
        },
        {
          "type": "product_card"
        }
      ]
    }
  ]
}
{% endschema %}
